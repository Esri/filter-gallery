/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */
import{r as t,c as i,h as e,F as n,g as a}from"./p-05d1dfc6.js";import{C as s,I as o,S as r}from"./p-26508b91.js";import{g as l,f as c}from"./p-52cc870b.js";import{g as m}from"./p-accdb0ce.js";import{g as h}from"./p-8a63221d.js";import{c as u}from"./p-e4acb5a8.js";const p=["ArrowUp","ArrowDown"],d=["ArrowUp","ArrowDown","End","Home"];let f=class{constructor(e){t(this,e),this.calciteActionMenuOpenChange=i(this,"calciteActionMenuOpenChange",7),this.expanded=!1,this.open=!1,this.overlayPositioning="absolute",this.placement="auto",this.actionElements=[],this.mutationObserver=u("mutation",(()=>this.getActions())),this.guid=`calcite-action-menu-${h()}`,this.menuId=`${this.guid}-menu`,this.menuButtonId=`${this.guid}-menu-button`,this.activeMenuItemIndex=-1,this.connectMenuButtonEl=()=>{const{el:t,menuButtonId:i,menuId:e,open:n,label:a}=this,s=l(t,r.trigger)||this.defaultMenuButtonEl;this.menuButtonEl!==s&&(this.disconnectMenuButtonEl(),this.menuButtonEl=s,this.setTooltipReferenceElement(),s&&(s.active=n,s.setAttribute("aria-controls",e),s.setAttribute("aria-expanded",n.toString()),s.setAttribute("aria-haspopup","true"),s.id||(s.id=i),s.label||(s.label=a),s.text||(s.text=a),s.addEventListener("click",this.menuButtonClick),s.addEventListener("keydown",this.menuButtonKeyDown),s.addEventListener("keyup",this.menuButtonKeyUp)))},this.disconnectMenuButtonEl=()=>{const{menuButtonEl:t}=this;t&&(t.removeEventListener("click",this.menuButtonClick),t.removeEventListener("keydown",this.menuButtonKeyDown),t.removeEventListener("keyup",this.menuButtonKeyUp))},this.setDefaultMenuButtonEl=t=>{this.defaultMenuButtonEl=t,this.connectMenuButtonEl()},this.handleCalciteActionClick=()=>{this.open=!1,this.setFocus()},this.menuButtonClick=()=>{this.toggleOpen()},this.setTooltipReferenceElement=()=>{const{el:t,expanded:i,menuButtonEl:e}=this,n=l(t,r.tooltip),a="SLOT"===(null==n?void 0:n.tagName)?n.assignedElements()[0]:n;"CALCITE-TOOLTIP"===(null==a?void 0:a.tagName)&&(a.referenceElement=i?null:e)},this.updateAction=(t,i)=>{const{guid:e,activeMenuItemIndex:n}=this,a=`${e}-action-${i}`;t.tabIndex=-1,t.setAttribute("role","menuitem"),t.id||(t.id=a),t.active=i===n},this.updateActions=t=>{null==t||t.forEach(this.updateAction)},this.getActions=()=>{const{el:t}=this,i=this.getAssignedElements().filter((t=>"CALCITE-ACTION"===t.tagName&&"trigger"!==t.slot)),e=i.length?i:Array.from(t.querySelectorAll("calcite-action:not([slot=trigger])"));this.updateActions(e),this.actionElements=e,this.connectMenuButtonEl()},this.menuButtonKeyUp=t=>{const{key:i}=t,{actionElements:e}=this;this.isValidKey(i,p)&&(t.preventDefault(),e.length&&(this.toggleOpen(!0),this.handleActionNavigation(i,e)))},this.menuButtonKeyDown=t=>{const{key:i}=t;this.isValidKey(i,p)&&t.preventDefault()},this.menuActionsContainerKeyDown=t=>{const{key:i}=t,{actionElements:e,activeMenuItemIndex:n}=this;if("Tab"!==i)if(" "!==i&&"Enter"!==i)this.isValidKey(i,d)&&t.preventDefault();else{t.preventDefault();const i=e[n];i?i.click():this.toggleOpen(!1)}else this.open=!1},this.menuActionsContainerKeyUp=t=>{const{key:i}=t,{actionElements:e}=this;"Escape"!==i?this.isValidKey(i,d)&&(t.preventDefault(),e.length&&this.handleActionNavigation(i,e)):this.toggleOpen(!1)},this.handleActionNavigation=(t,i)=>{const e=this.activeMenuItemIndex;"Home"===t&&(this.activeMenuItemIndex=0),"End"===t&&(this.activeMenuItemIndex=i.length-1),"ArrowUp"===t&&(this.activeMenuItemIndex=m(Math.max(e-1,-1),i.length)),"ArrowDown"===t&&(this.activeMenuItemIndex=m(e+1,i.length))},this.toggleOpenEnd=()=>{this.setFocus(),this.el.removeEventListener("calcitePopoverOpen",this.toggleOpenEnd)},this.toggleOpen=(t=!this.open)=>{this.el.addEventListener("calcitePopoverOpen",this.toggleOpenEnd),this.open=t}}connectedCallback(){var t;null===(t=this.mutationObserver)||void 0===t||t.observe(this.el,{childList:!0,subtree:!0}),this.getActions()}disconnectedCallback(){var t;null===(t=this.mutationObserver)||void 0===t||t.disconnect(),this.disconnectMenuButtonEl()}expandedHandler(){this.open=!1,this.setTooltipReferenceElement()}openHandler(t){this.activeMenuItemIndex=this.open?0:-1,this.menuButtonEl&&(this.menuButtonEl.active=t),this.calciteActionMenuOpenChange.emit(t)}closeCalciteActionMenuOnClick(t){t.composedPath().includes(this.el)||(this.open=!1)}activeMenuItemIndexHandler(){this.updateActions(this.actionElements)}async setFocus(){c(this.open?this.menuEl:this.menuButtonEl)}renderMenuButton(){const{el:t,label:i,scale:n}=this,a=e("slot",{name:r.trigger},e("calcite-action",{class:s.defaultTrigger,icon:o.menu,ref:this.setDefaultMenuButtonEl,scale:n,text:i}));return l(t,r.tooltip)?e("calcite-tooltip-manager",null,a):a}renderMenuItems(){const{actionElements:t,activeMenuItemIndex:i,open:n,menuId:a,menuButtonEl:o,label:r,placement:l,overlayPositioning:c}=this,m=t[i];return e("calcite-popover",{disablePointer:!0,label:r,offsetDistance:0,open:n,overlayPositioning:c,placement:l,referenceElement:o},e("div",{"aria-activedescendant":(null==m?void 0:m.id)||null,"aria-labelledby":null==o?void 0:o.id,class:s.menu,id:a,onClick:this.handleCalciteActionClick,onKeyDown:this.menuActionsContainerKeyDown,onKeyUp:this.menuActionsContainerKeyUp,ref:t=>this.menuEl=t,role:"menu",tabIndex:-1},e("slot",null)))}render(){return e(n,null,this.renderMenuButton(),this.renderMenuItems(),e("slot",{name:r.tooltip}))}getAssignedElements(){return Array.from(this.el.querySelectorAll("slot")).map((t=>t.assignedElements({flatten:!0}))).reduce(((t,i)=>t.concat(i)),[])}isValidKey(t,i){return!!i.find((i=>i===t))}get el(){return a(this)}static get watchers(){return{expanded:["expandedHandler"],open:["openHandler"],activeMenuItemIndex:["activeMenuItemIndexHandler"]}}};f.style="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:300ms}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:150ms ease-in-out}:host([hidden]){display:none}:host{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size-1)}.menu ::slotted(calcite-action){display:-ms-flexbox;display:flex;outline-offset:0;outline-color:transparent;-webkit-transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;margin:0.125rem}::slotted(calcite-action[active]){outline:2px solid var(--calcite-ui-brand);outline-offset:2px;outline-offset:0px}.default-trigger{-ms-flex-item-align:stretch;align-self:stretch;-ms-flex:0 1 auto;flex:0 1 auto;height:100%;position:relative}slot[name=trigger]::slotted(calcite-action),calcite-action::slotted([slot=trigger]){-ms-flex-item-align:stretch;align-self:stretch;-ms-flex:0 1 auto;flex:0 1 auto;height:100%;position:relative}.menu{-ms-flex-direction:column;flex-direction:column;-ms-flex-wrap:nowrap;flex-wrap:nowrap;outline:2px solid transparent;outline-offset:2px}";export{f as calcite_action_menu}