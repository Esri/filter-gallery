/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import e from"../core/Error.js";import{isNone as t,isSome as o}from"../core/maybe.js";import{g as r,f as n,d as i,b as s,a}from"./vec3.js";import{c}from"./vec3f64.js";import{canProjectToWGS84ComparableLonLat as l}from"../geometry/projection.js";import{containsPoint as f,containsPointWithMargin as m,fromExtent as u,create as p}from"../geometry/support/aaBoundingRect.js";import{MAX_ROOT_TILES as h}from"../views/3d/terrain/TerrainConst.js";import g,{getMissingTileInfoError as d}from"../views/3d/terrain/TilingScheme.js";const M=c(),j=c(),S=c(),v=c();function x(e,o,r=0){const n=e.extent;if(t(n))return!1;if(0===r)return f(n,o);const i=Math.min(n[2]-n[0],n[3]-n[1]);return m(n,o,r*i)}function w(e,t,o,c){r(M,o),M[c]=t[c];const l=n(M,M,t),f=n(j,e,t),m=i(f,l),u=i(l,l);let p;p=m<=0?t:u<=m?o:s(M,t,a(l,l,m/u));const h=n(M,e,p);return Math.PI/2-Math.atan(h[2]/Math.sqrt(h[0]*h[0]+h[1]*h[1]))}function R(e,o,r){const n=e.extent;if(t(n))return 0;S[0]=n[0],S[1]=n[1],S[2]=r,v[0]=n[2],v[1]=n[3],v[2]=r;let i=1/0,s=1/0;return o[0]<S[0]?i=w(o,S,v,0):o[0]>v[0]&&(i=w(o,v,S,0)),o[1]<S[1]?s=w(o,S,v,1):o[1]>v[1]&&(s=w(o,v,S,1)),Math.min(i,s)}function T(r,n,i){if(t(r))return d();if(r.spatialReference.isGeographic&&!l(r.spatialReference))return new e("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const s=g.checkUnsupported(r);if(o(s))return s;const a=y(r,i);if(a)return a;const c=r.spatialReference;return n&&!(c.equals(n)||n.isWGS84&&c.isWebMercator)?new e("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function y(t,o){const r=t.lods,n=r[0].resolution*2**r[0].level,i=[n*t.size[0],n*t.size[1]],s=[t.origin.x,t.origin.y],a=u(o),c=p();g.computeRowColExtent(a,i,s,c);const l=(c[2]-c[0])*(c[3]-c[1]);if(l>h){const o=r[0].scale*2**r[0].level;let i=Math.max((a[3]-a[1])/t.size[1],(a[2]-a[0])/t.size[0])*o/n;const s=Math.floor(Math.log(i)/Math.log(10));return i=Math.ceil(i/10**s)*10**s,new e("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(o).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+i.toLocaleString()+".",{level0Scale:o,suggestedLevel0Scale:i,requiredNumRootTiles:l,allowedNumRootTiles:h})}return null}const z=Object.freeze({__proto__:null,isInsideExtent:x,tiltToExtentEdge:R,checkIfTileInfoSupportedForViewSR:T});export{R as a,T as c,x as i,z as t};
