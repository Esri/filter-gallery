/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{deg2rad as t,rad2deg as e,asinClamped as o}from"../core/mathUtils.js";import{d as a,e as n}from"./mat4.js";import{c as s}from"./mat4f64.js";import{n as i,c as r,d as c,m as l,o as m,l as f,a as p}from"./vec3.js";import{f as h,c as u}from"./vec3f64.js";import y from"../geometry/Extent.js";import{getReferenceEllipsoid as M}from"../geometry/projectionEllipsoid.js";import d from"../geometry/SpatialReference.js";import{geographicToWebMercator as j}from"../geometry/support/webMercatorUtils.js";import{createDirectionUp as T,directionToHeadingTilt as g}from"../views/3d/support/cameraUtilsInternal.js";import{getLonDeltaForDistance as x}from"../views/3d/support/earthUtils.js";import{Cyclical as R,cyclical2PI as b}from"../views/3d/support/mathUtils.js";const w=h(0,0,1),I=i(u(),h(1,1,1)),U=new R(-180,180),v=s(),P=u(),q=u();function E(e,o,s,f=T()){r(P,e,w),0===c(P,P)&&r(P,e,I),a(v,-t(o),e),n(v,v,-t(s),P);const{up:p,direction:h}=f;return r(p,P,e),i(p,p),l(p,p,v),i(h,e),m(h,h),l(h,h,v),f}function _(t,e,o,a){const n=P,s=q;return i(n,t),r(q,n,w),0===c(q,q)&&r(q,n,I),r(s,q,n),g(e,o,a,n,s)}function H(e,a,n,s){const i={eye:u(),up:null,tilt:s,heading:n},r=P;r[0]=e[0],r[1]=e[2],r[2]=-e[1];const c=a,l=t(n),m=t(s),h=Math.sin(l),y=Math.cos(l),M=Math.sin(m),d=Math.cos(m),j=f(r);let T;if(Math.abs(m)<1e-8)T=c+j;else{const t=j/M,e=o(c/t),a=Math.PI-m-e;T=t*Math.sin(a)}const g=d*c,x=c*c*(M*M),R=y*y*x,b=T-g,w=b*b,I=R*(R+w-r[1]*r[1]);if(I<0)return p(i.eye,r,T/j),i.tilt=0,i;const U=Math.sqrt(I),v=r[1]*b,q=R+w;let E;if(E=y>0?-U+v:U+v,Math.abs(q)<1e-8)return j<1e-8?(i.eye[0]=0,i.eye[1]=0,i.eye[2]=c):p(i.eye,r,T/j),i.tilt=0,W(i.eye),k(i,e);i.eye[1]=E/q;const _=h*h*x,H=M*c,z=y*H*i.eye[1],A=i.eye[1]*i.eye[1],G=1-A,S=Math.sqrt(G),C=R*A+_-2*z*S*b+G*w;return Math.abs(C)<1e-8?(p(i.eye,r,T/j),i.tilt=0,W(i.eye),k(i,e)):(i.eye[0]=(G*(T*r[0]-g*r[0])-H*S*(r[0]*i.eye[1]*y+r[2]*h))/C,i.eye[2]=(G*(T*r[2]-g*r[2])-H*S*(r[2]*i.eye[1]*y-r[0]*h))/C,p(i.eye,i.eye,T),W(i.eye),k(i,e))}function W(t){const e=t[1];t[1]=-t[2],t[2]=e}function k(t,e){const o=E(e,t.heading,t.tilt);return t.up=o.up,t}function z(t,a,n){const s=f(a),i=Math.sqrt(n*n+s*s-2*n*s*Math.cos(Math.PI-t)),r=o(n/(i/Math.sin(t)));return e(t-r)}function A(e,a,n){const s=t(e),i=f(a);return o(n/(i/Math.sin(s)))+s}function G(o,a,n,s,i){let r,c,l,m;const f=a.latitude,p=M(o.spatialReference).radius,h=a.longitude,u=x(f,n,p)/2;r=h-u,c=h+u;const T=t(f),g=(1+Math.sin(T))/(1-Math.sin(T)),R=(g+1)*Math.tan(s/p/2),w=R*R;function I(t){const e=Math.PI/2;return(t=b.normalize(t,-e))>e&&(t=Math.PI-t),t}if(l=1.5*Math.PI-2*Math.atan(.5*(R+Math.sqrt(4*g+w))),m=l+s/p,l=I(l),m=I(m),m<l){const t=m;m=l,l=t}if(l=Math.max(e(l),-90),m=Math.min(e(m),90),c=U.monotonic(r,c),c-r>180){const t=(c-r-180)/2;r+=t,c-=t}const v=o.spatialReference&&o.spatialReference.isGeographic?o.spatialReference:d.WGS84;return i?(i.xmin=r,i.ymin=l,i.xmax=c,i.ymax=m,i.spatialReference=v):i=new y(r,l,c,m,v),o.spatialReference&&o.spatialReference.isWebMercator&&j(i,!1,i),i}const S=Object.freeze({__proto__:null,headingTiltToDirectionUp:E,directionToHeadingTilt:_,eyeForCenterWithHeadingTilt:H,lookAtTiltToEyeTilt:z,eyeTiltToLookAtTilt:A,toExtent:G});export{A as a,S as c,_ as d,H as e,E as h,z as l,G as t};
