/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{compileScript as e,extend as t,enableAsyncSupport as r}from"../arcade/arcadeCompiler.js";import{extend as n,executeScript as s,referencesMember as i,referencesFunction as c}from"../arcade/arcadeRuntime.js";import{parseScript as u,validateScript as a,scriptCheck as o,extractFieldLiterals as f,extractExpectedFieldLiterals as p}from"../arcade/parser.js";import{findScriptDependencies as l,findFunctionCalls as d}from"../arcade/treeAnalysis.js";import m from"../core/has.js";import{all as y,create as S}from"../core/promiseUtils.js";const h=["feature","angle","bearing","centroid","envelopeintersects","extent","geometry","isselfintersecting","ringisclockwise"];function x(){return!0}const b=x();let A=!1,g=!1,j=null,E=[];function F(t,r){if(!0===r.useAsync||!0===t.isAsync)return v(t,r);if(m("esri-csp-restrictions")){return function(e){return s(t,e)}}return e(t,r)}function v(t,r){if(null===j)throw new Error("Async Arcade must be enabled for this script");if(m("esri-csp-restrictions")||!1===b){return function(e){return j.executeScript(t,e)}}return e(t,r,!0)}function G(e){n(e),t(e,"sync"),null===j?E.push(e):(t(e,"async"),j.extend(e))}function w(e,t=[]){return u(e,t)}function k(e,t,r=""){return a(e,t,r)}function U(e,t,r,n=""){return o(e,t,r,n)}function L(e,t,r=[]){return _(u(e,r),t)}function _(e,t){if(!0===t.useAsync||!0===e.isAsync){if(null===j)throw new Error("Async Arcade must be enabled for this script");return j.executeScript(e,t)}return s(e,t)}function C(e,t){return i(e,t)}function M(e,t){return c(e,t)}function O(e,t=!1){return f(e)}function R(e){return p(e)}function q(e,t=[]){return void 0===e.usesGeometry&&l(e,t),!0===e.usesGeometry}let z=null;function D(){return z||(z=y([import("../geometry/geometryEngine.js"),import("../arcade/functions/geomsync.js")]).then((([e,t])=>(g=!0,t.setGeometryEngine(e),!0))),z)}let I=null;function T(){return null!==I||(I=r().then((()=>import("../arcade/arcadeAsyncRuntime.js"))).then((e=>{j=e;for(const r of E)j.extend(r),t(r,"async");return E=null,!0}))),I}function B(){return A}function H(){return!!j}function J(){return g}let K=null;function N(){return K||(K=T().then((()=>y([import("../arcade/featureSetUtils.js"),import("../arcade/functions/featuresetbase.js"),import("../arcade/functions/featuresetgeom.js"),import("../arcade/functions/featuresetstats.js"),import("../arcade/functions/featuresetstring.js")]).then((([e,r,n,s,i])=>(Y=e,j.extend([r,n,s,i]),t([r,n,s,i],"async"),A=!0,!0))))),K)}function P(e,t=[]){return void 0===e.usesFeatureSet&&l(e,t),!0===e.usesFeatureSet}function Q(e,t=[]){return void 0===e.isAsync&&l(e,t),!0===e.isAsync}function V(e,t){if(t){for(const r of t)if(C(e,r))return!0;return!1}return!1}function W(e,t,r=[],n=!1){return S(((s,i)=>{const c="string"==typeof e?w(e):e,u=[];c&&(!1===J()&&(q(c)||n)&&u.push(D()),!1===H()&&(!0===c.isAsync||t)&&u.push(T()),!1===B()&&(P(c)||V(c,r))&&u.push(N())),u.length?y(u).then((()=>{s(!0)}),i):s(!0)}))}function X(e){if(q(e))return!0;const t=d(e);let r=!1;for(let n=0;n<t.length;n++)if(h.indexOf(t[n])>-1){r=!0;break}return r}let Y=null;function Z(){return Y}const $=Object.freeze({__proto__:null,compileScript:F,extend:G,parseScript:w,validateScript:k,scriptCheck:U,parseAndExecuteScript:L,executeScript:_,referencesMember:C,referencesFunction:M,extractFieldLiterals:O,extractExpectedFieldLiterals:R,scriptUsesGeometryEngine:q,enableGeometrySupport:D,enableAsyncSupport:T,isFeatureSetSupportEnabled:B,isAsyncEnabled:H,isGeometryEnabled:J,enableFeatureSetSupport:N,scriptUsesFeatureSet:P,scriptIsAsync:Q,loadScriptDependencies:W,scriptTouchesGeometry:X,featureSetUtils:Z});export{R as a,D as b,F as c,N as d,_ as e,Z as f,q as g,$ as h,G as i,U as j,L as k,W as l,M as m,O as n,T as o,w as p,B as q,C as r,X as s,H as t,J as u,k as v,P as w,Q as x};
