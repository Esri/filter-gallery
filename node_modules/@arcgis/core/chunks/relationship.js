/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import e from"../Color.js";import{clone as o}from"../core/lang.js";import r from"../smartMapping/symbology/support/colors.js";import{createThemes as a,getThemesforBasemap as n,getRawSchemes as s,filterSchemesByName as l,filterSchemesByTag as t}from"../smartMapping/symbology/support/symbologyUtils.js";import{toWorldScale as i,hasIdenticalColors as p}from"../smartMapping/symbology/support/utils.js";const u={light:{color:[153,153,153,.25],width:"1px"},dark:{color:[153,153,153,.25],width:"1px"},darker:{color:[26,26,26,.25],width:"1px"}},c={lightBasemaps:{primary:"relationship-blue-orange-brown",secondary:["relationship-brewer-yellow-blue-black","relationship-brewer-pink-blue-purple","relationship-purple-green-blue","relationship-blue-green-purple","relationship-blue-orange-green","relationship-mustard-blue-wine","relationship-pink-blue-purple","relationship-olive-blue-green","relationship-yellow-cyan-blue","relationship-blue-pink-purple","relationship-purple-green-wine","relationship-blue-peach-purple","relationship-mint-mustard-green","relationship-purple-mustard-darkpurple","relationship-blue-orange-purple","relationship-pink-periwinkle-violet","relationship-blue-tan-green","relationship-blue-red-pink","relationship-blue-green-brightgreen","relationship-blue-orange-lavender","relationship-pink-purple-peach","relationship-purple-mustard-eggshell","relationship-blue-brick-green","relationship-orange-purple-lavender","relationship-brown-purple-lilac","relationship-teal-yellow-lightteal"]},darkBasemaps:{primary:"relationship-blue-green-brightgreen",secondary:["relationship-blue-red-pink","relationship-blue-orange-lavender","relationship-pink-purple-peach","relationship-purple-mustard-eggshell","relationship-blue-brick-green","relationship-orange-purple-lavender","relationship-brown-purple-lilac","relationship-teal-yellow-lightteal","relationship-blue-orange-brown","relationship-brewer-yellow-blue-black","relationship-brewer-pink-blue-purple","relationship-purple-green-blue","relationship-blue-green-purple","relationship-blue-orange-green","relationship-mustard-blue-wine","relationship-pink-blue-purple","relationship-olive-blue-green","relationship-yellow-cyan-blue","relationship-blue-pink-purple","relationship-purple-green-wine","relationship-blue-peach-purple","relationship-mint-mustard-green","relationship-purple-mustard-darkpurple","relationship-blue-orange-purple","relationship-pink-periwinkle-violet","relationship-blue-tan-green"]}},m="#aaaaaa",h="8px",g="2px",d=a({themeDictionary:{default:{name:"default",label:"Default",description:"Default theme for visualizing features based on relationship between two attributes.",schemes:{point:{light:{common:{noDataColor:m,outline:u.light,size:h},primary:c.lightBasemaps.primary,secondary:c.lightBasemaps.secondary},dark:{common:{noDataColor:m,outline:u.darker,size:h},primary:c.darkBasemaps.primary,secondary:c.darkBasemaps.secondary}},polyline:{light:{common:{noDataColor:m,width:g},primary:c.lightBasemaps.primary,secondary:c.lightBasemaps.secondary},dark:{common:{noDataColor:m,width:g},primary:c.darkBasemaps.primary,secondary:c.darkBasemaps.secondary}},polygon:{light:{common:{noDataColor:m,outline:u.light,fillOpacity:.8},primary:c.lightBasemaps.primary,secondary:c.lightBasemaps.secondary},dark:{common:{noDataColor:m,outline:u.dark,fillOpacity:.8},primary:c.darkBasemaps.primary,secondary:c.darkBasemaps.secondary}}}}}});function y(e){return n(d,e)}function b(e){const o="default",r=s({basemap:e.basemap,geometryType:e.geometryType,basemapTheme:e.basemapTheme,theme:d.get(o)});if(!r)return;const{schemesInfo:a,basemapId:n,basemapTheme:l}=r,t={...e,basemap:n};return{primaryScheme:z(t,a.primary,a.common),secondarySchemes:a.secondary.map((e=>z(t,e,a.common))).filter(Boolean),basemapId:n,basemapTheme:l}}function f(e){return l(e.name,b(e))}function w(e){return t(e.includedTags,e.excludedTags,b(e))}function C(o){if(!o)return;const r={...o};return r.colorsForClassBreaks=r.colorsForClassBreaks.map((o=>({numClasses:o.numClasses,colors:o.colors.map((o=>o.map((o=>new e(o)))))}))),r.tags=[...r.tags],r.noDataColor&&(r.noDataColor=new e(r.noDataColor)),"outline"in r&&r.outline&&(r.outline={color:r.outline.color&&new e(r.outline.color),width:r.outline.width}),r}function k(e,r){e=o(e);let a=[];const n=(r||"HH").split(""),s=n[0],l=n[1];"L"===s&&e.reverse();const t="H"===l;return e.forEach((e=>{t&&e.reverse(),a=a.concat(e)})),a}function B(o,r,a){let n;return o.colorsForClassBreaks.some((e=>(e.numClasses===r&&(n=e.colors),!!n))),n=n.map((o=>o.map((o=>new e(o))))),n?k(n,a):null}function D(e,o){const r=o?e:C(e);return r.colorsForClassBreaks.forEach((e=>{const o=e.colors.reverse(),r=[];for(let a=0;a<e.numClasses;a++){const e=[];o.forEach((o=>{e.push(o[a])})),r.push(e)}e.colors=r})),r}function F(e){const o=e.theme||"default",r=e.geometryType,a=e.colors,n=e.numClasses,s=d.get(o);if(!s)return;const l=s.supportedBasemaps,t=[];return l.forEach((e=>{const s=b({theme:o,basemap:e,geometryType:r});if(s){let e=S(s.primaryScheme,a,n);e&&t.push(e),s.secondarySchemes.forEach((o=>{e=S(o,a,n),e&&t.push(e)}))}})),t}function T(e,o,r,a){let n;const s=B(e,r,a);if(s){1===p(o,s)&&(n=e)}return n}function v(e,o,r,a){let n,s=1;do{n=T(e,o,r,a),n||(e=D(e),s++)}while(!n&&s<=4);return n}function S(e,o,r){return v(e,o,r,"HH")||v(e,o,r,"HL")||v(e,o,r,"LH")||v(e,o,r,"LL")}function z(e,o,a){const n="mesh"!==e.geometryType&&e.worldScale?e.view:null,s=r[o],l=e.theme||"default";if(!s)return;const t=l+"/"+e.basemap+"/"+o,i=[];for(const r in s)if("stops"!==r&&"name"!==r&&"tags"!==r){const e=+r,o=s[r];i.push({numClasses:e,colors:o})}switch(e.geometryType){case"point":case"multipoint":{const e=a;return x({id:t,name:s.name,tags:s.tags,colorsForClassBreaks:i,noDataColor:e.noDataColor,opacity:1,outline:e.outline,size:e.size},n)}case"polyline":{const e=a;return H({id:t,name:s.name,tags:s.tags,colorsForClassBreaks:i,noDataColor:e.noDataColor,opacity:1,width:e.width},n)}case"polygon":{const e=a;return j({id:t,name:s.name,tags:s.tags,colorsForClassBreaks:i,noDataColor:e.noDataColor,opacity:e.fillOpacity,outline:e.outline})}case"mesh":{const e=a;return E({id:t,name:s.name,tags:s.tags,colorsForClassBreaks:i,noDataColor:e.noDataColor,opacity:e.fillOpacity})}}}function x(o,r){return{id:o.id,name:o.name,tags:[...o.tags],colorsForClassBreaks:L(o.colorsForClassBreaks),noDataColor:new e(o.noDataColor),outline:{color:new e(o.outline.color),width:o.outline.width},size:r?i(o.size,r):o.size,opacity:o.opacity}}function H(o,r){return{id:o.id,name:o.name,tags:[...o.tags],colorsForClassBreaks:L(o.colorsForClassBreaks),noDataColor:new e(o.noDataColor),opacity:o.opacity,width:r?i(o.width,r):o.width}}function j(o){return{id:o.id,name:o.name,tags:[...o.tags],colorsForClassBreaks:L(o.colorsForClassBreaks),noDataColor:new e(o.noDataColor),outline:{color:new e(o.outline.color),width:o.outline.width},opacity:o.opacity}}function E(o){return{id:o.id,name:o.name,tags:[...o.tags],colorsForClassBreaks:L(o.colorsForClassBreaks),noDataColor:new e(o.noDataColor),opacity:o.opacity}}function L(o){return o.map((o=>({numClasses:o.numClasses,colors:o.colors.map((o=>o.map((o=>new e(o)))))})))}const O=Object.freeze({__proto__:null,getThemes:y,getSchemes:b,getSchemeByName:f,getSchemesByTag:w,cloneScheme:C,flatten2DArray:k,getColors:B,flipColors:D,getMatchingSchemes:F});export{b as a,y as b,C as c,f as d,w as e,k as f,B as g,D as h,F as i,O as r};
