/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import n from"../arcade/FunctionWrapper.js";import r from"../arcade/ImmutableArray.js";import{p as t,t as e,B as o,C as u,b as i,a as s,v as a,e as c,i as f,N as l,S as d}from"./languageUtils.js";import{resolve as h,isPromiseLike as w}from"../core/promiseUtils.js";function m(m){function g(r,t){if(t instanceof n)return m.arcadeCustomFunctionHandler(t);if(t instanceof l)return(...n)=>t.fn(r,{preparsed:!0,arguments:n});if(t instanceof d)return(...n)=>{if(n.length!==t.paramCount)throw new Error("Invalid parameters");return t.fn(...n)};throw new Error("Invalid Parameter")}function p(n){if(n instanceof r)return n.toArray();if(s(n))return n;throw new Error("Invalid Parameter")}m.functions.array=function(n,r){return m.standardFunction(n,r,(function(n,r,i){t(i,1,2);const s=e(i[0]);if(isNaN(s)||!1===o(s))throw new Error("Invalid Parameter");const a=u(i[1],null),c=new Array(s);return c.fill(a),c}))},m.functions.front=function(n,r){return m.standardFunction(n,r,(function(n,r,e){if(t(e,1,1),i(e[0])){if(e[0].length()<=0)throw new Error("Array is empty");return e[0].get(0)}if(s(e[0])){if(e[0].length<=0)throw new Error("Array is empty");return e[0][0]}throw new Error("Invalid Parameter")}))},m.functions.back=function(n,r){return m.standardFunction(n,r,(function(n,r,e){if(t(e,1,1),i(e[0])){if(e[0].length()<=0)throw new Error("Array is empty");return e[0].get(e[0].length()-1)}if(s(e[0])){if(e[0].length<=0)throw new Error("Array is empty");return e[0][e[0].length-1]}throw new Error("Invalid Parameter")}))},m.functions.push=function(n,r){return m.standardFunction(n,r,(function(n,r,e){if(t(e,1,2),s(e[0]))return e[0][e[0].length]=e[1],e[0].length;throw new Error("Invalid Parameter")}))},m.functions.pop=function(n,r){return m.standardFunction(n,r,(function(n,r,e){if(t(e,1,1),s(e[0])){if(e[0].length<=0)throw new Error("Array is empty");const n=e[0][e[0].length-1];return e[0].length=e[0].length-1,n}throw new Error("Invalid Parameter")}))},m.functions.erase=function(n,r){return m.standardFunction(n,r,(function(n,r,u){if(t(u,2,2),s(u[0])){let n=e(u[1]);if(isNaN(n)||!1===o(n))throw new Error("Invalid Parameter");const r=u[0];if(r.length<=0)throw new Error("Array is empty");if(n<0&&(n=r.length+n),n<0)throw new Error("Element not found");if(n>=r.length)throw new Error("Index is greater than array");return r.splice(n,1),a}throw new Error("Invalid Parameter")}))},m.functions.insert=function(n,r){return m.standardFunction(n,r,(function(n,r,u){if(t(u,3,3),s(u[0])){const n=e(u[1]);if(isNaN(n)||!1===o(n))throw new Error("Invalid Parameter");const r=u[2],t=u[0];if(n>t.length)throw new Error("Index is greater than array");if(n<0&&n<-1*t.length)throw new Error("Index is greater than array");return n===t.length?(t[n]=r,a):(t.splice(n,0,r),a)}throw new Error("Invalid Parameter")}))},m.functions.resize=function(n,r){return m.standardFunction(n,r,(function(n,r,i){if(t(i,2,3),s(i[0])){const n=e(i[1]);if(isNaN(n)||!1===o(n))throw new Error("Invalid Parameter");if(n<0)throw new Error("Size cannot be negative");const r=u(i[2],null),t=i[0];if(t.length>=n)return t.length=n,a;const s=t.length;t.length=n;for(let e=s;e<t.length;e++)t[e]=r;return a}throw new Error("Invalid Parameter")}))},m.functions.includes=function(n,r){return m.standardFunction(n,r,(function(n,r,e){if(t(e,2,2),s(e[0])){const n=e[1];return e[0].findIndex((r=>c(r,n)))>-1}if(i(e[0])){const n=e[1];return e[0].toArray().findIndex((r=>c(r,n)))>-1}throw new Error("Invalid Parameter")}))},m.functions.slice=function(n,r){return m.standardFunction(n,r,(function(n,r,a){if(t(a,1,3),s(a[0])){const n=e(u(a[1],0)),r=e(u(a[2],a[0].length));if(isNaN(n)||!1===o(n))throw new Error("Invalid Parameter");if(isNaN(r)||!1===o(r))throw new Error("Invalid Parameter");return a[0].slice(n,r)}if(i(a[0])){const n=a[0],r=e(u(a[1],0)),t=e(u(a[2],n.length()));if(isNaN(r)||!1===o(r))throw new Error("Invalid Parameter");if(isNaN(t)||!1===o(t))throw new Error("Invalid Parameter");return n.toArray().slice(r,t)}throw new Error("Invalid Parameter")}))},m.functions.splice=function(n,r){return m.standardFunction(n,r,(function(n,r,t){const e=[];for(let o=0;o<t.length;o++)s(t[o])?e.push(...t[o]):i(t[o])?e.push(...t[o].toArray()):e.push(t[o]);return e}))},"sync"===m.mode&&(m.functions.any=function(n,r){return m.standardFunction(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]);for(const n of i){const r=u(n);if(f(r)&&!0===r)return!0}return!1}))},m.functions.all=function(n,r){return m.standardFunction(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]);for(const n of i){if(!0!==u(n))return!1}return!0}))},m.functions.none=function(n,r){return m.standardFunction(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]);for(const n of i){if(!0===u(n))return!1}return!0}))},m.functions.reduce=function(n,r){return m.standardFunction(n,r,(function(r,e,o){t(o,2,3);const u=g(n,o[1]),i=p(o[0]);return 2===o.length?0===i.length?null:i.reduce(((n,r)=>{const t=u(n,r);return n=void 0!==t&&t!==a?t:null})):i.reduce(((n,r)=>{const t=u(n,r);return n=void 0!==t&&t!==a?t:null}),o[2])}))},m.functions.map=function(n,r){return m.standardFunction(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]),s=[];for(const n of i){const r=u(n);void 0!==r&&r!==a?s.push(r):s.push(null)}return s}))},m.functions.filter=function(n,r){return m.standardFunction(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]),s=[];for(const n of i){!0===u(n)&&s.push(n)}return s}))}),"async"===m.mode&&(m.functions.any=function(n,r){return m.standardFunctionAsync(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]),s={result:!1};return i.reduce(((n,r,t)=>n.then((n=>{if(t>0&&!0===n&&(s.result=!0),!0===s.result)return h(!0);const e=u(r);return w(e)?e:h(e)}))),Promise.resolve(!1)).then((n=>(!0===n&&(s.result=!0),s.result)))}))},m.functions.all=function(n,r){return m.standardFunctionAsync(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]),s={result:!0};return i.reduce(((n,r,t)=>n.then((n=>{if(t>0&&!0!==n&&(s.result=!1),!1===s.result)return h(!1);const e=u(r);return w(e)?e:h(e)}))),Promise.resolve(!0)).then((n=>(!0!==n&&(s.result=!1),s.result)))}))},m.functions.none=function(n,r){return m.standardFunctionAsync(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]),s={result:!0};return i.reduce(((n,r,t)=>n.then((n=>{if(t>0&&!0===n&&(s.result=!1),!1===s.result)return h(!0);const e=u(r);return w(e)?e:h(e)}))),Promise.resolve(!1)).then((n=>(!0===n&&(s.result=!1),s.result)))}))},m.functions.filter=function(n,r){return m.standardFunctionAsync(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]),s=[];return i.reduce(((n,r,t)=>n.then((n=>{t>0&&!0===n&&s.push(i[t-1]);const e=u(r);return w(e)?e:h(e)}))),Promise.resolve(!1)).then((n=>(!0===n&&i.length>0&&s.push(i[i.length-1]),s)))}))},m.functions.reduce=function(n,r){return m.standardFunctionAsync(n,r,(function(r,e,o){t(o,2,3);const i=g(n,o[1]),s=p(o[0]);let c=null;if(o.length>2){const n=u(o[2],null);c=s.reduce(((n,r)=>n.then((n=>{void 0!==n&&n!==a||(n=null);const t=i(n,r);return w(t)?t:h(t)}))),Promise.resolve(n))}else{if(0===s.length)return null;c=s.reduce(((n,r,t)=>{if(t<=1){const t=i(n,r);return w(t)?t:h(t)}return n.then((n=>{void 0!==n&&n!==a||(n=null);const t=i(n,r);return w(t)?t:h(t)}))}))}return c.then((n=>void 0!==n&&n!==a?n:null))}))},m.functions.map=function(n,r){return m.standardFunctionAsync(n,r,(function(r,e,o){t(o,2,2);const u=g(n,o[1]),i=p(o[0]),s={result:[]};return i.reduce(((n,r,t)=>n.then((n=>{t>0&&(void 0!==n&&n!==a?s.result.push(n):s.result.push(null));const e=u(r);return w(e)?e:h(e)}))),Promise.resolve()).then((n=>(i.length>0&&(void 0!==n&&n!==a?s.result.push(n):s.result.push(null)),s.result)))}))})}const g=Object.freeze({__proto__:null,registerFunctions:m});export{g as A,m as r};
