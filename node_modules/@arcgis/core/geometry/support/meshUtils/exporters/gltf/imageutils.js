/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import"../../../../../core/has.js";import t from"../../../../../core/Error.js";import{isSome as e,isNone as n}from"../../../../../core/maybe.js";import{isDataProtocol as r,dataComponents as a}from"../../../../../core/urlUtils.js";function i(t){const n=m(t);return e(n)?n.toDataURL():""}async function o(e){const r=m(e);if(n(r))throw new t("imageToArrayBuffer","Unsupported image type");const a=await c(e),i=await new Promise((t=>r.toBlob(t,a)));if(!i)throw new t("imageToArrayBuffer","Failed to encode image");return{data:await i.arrayBuffer(),type:a}}async function c(t){if(!(t instanceof HTMLImageElement))return"image/png";const e=t.src;if(r(e)){const{mediaType:t}=a(e);return"image/jpeg"===t?t:"image/png"}return/\.png$/i.test(e)?"image/png":/\.(jpg|jpeg)$/i.test(e)?"image/jpeg":"image/png"}function m(t){if(t instanceof HTMLCanvasElement)return t;if(t instanceof HTMLVideoElement)return null;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return t instanceof HTMLImageElement?n.drawImage(t,0,0,t.width,t.height):t instanceof ImageData&&n.putImageData(t,t.width,t.height),e}function g(t){const e=[],n=new Uint8Array(t);for(let r=0;r<n.length;r++)e.push(String.fromCharCode(n[r]));return"data:application/octet-stream;base64,"+btoa(e.join(""))}function s(t){if(t.byteLength<8)return!1;const e=new Uint8Array(t);return 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}export{g as encodeBase64DataUri,o as imageToArrayBuffer,i as imageToDataURI,s as isArrayBufferPNG};
