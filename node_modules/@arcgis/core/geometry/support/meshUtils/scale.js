/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import{isSome as t}from"../../../core/maybe.js";import{s as r,f as o,a as i,b as n}from"../../../chunks/vec3.js";import{c as s,Z as a}from"../../../chunks/vec3f64.js";import{projectPointToVector as c}from"../../projection.js";import{getSphericalPCPF as l}from"../../projectionEllipsoid.js";import{isGeographicMesh as p}from"./geographicUtils.js";import{projectToPCPF as f,projectNormalToPCPF as g,projectTangentToPCPF as m,projectFromPCPF as u,projectNormalFromPCPF as h,projectTangentFromPCPF as v}from"./projection.js";const d=e.getLogger("esri.geometry.support.meshUtils.scale");function j(e,r,o){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const i=e.spatialReference;if(t(e.transform)){var n;null!=(null==o?void 0:o.geographic)&&o.geographic!==e.transform.geographic&&d.warn(`Specifying the 'geographic' parameter (${o.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const t=null!=(n=null==o?void 0:o.origin)?n:e.transform.getOriginPoint(i);x(e.transform,r,t)}else{const t=p(e.spatialReference,o),i=o&&o.origin||e.origin;t?A(e,r,i):b(e,r,i)}}function x(e,t,a){const c=r(w,a.x,a.y,a.z),l=o(w,c,e.origin);e.applyLocalInverse(l,k);const p=i(s(),e.scale,t);e.scale=p,e.applyLocalInverse(l,l),o(l,l,k),e.translation=n(s(),e.translation,l)}function A(e,r,o){const i=e.spatialReference,n=l(i),s=R;c(o,s,n)||c(e.origin,s,n);const a=e.vertexAttributes.position,p=e.vertexAttributes.normal,d=e.vertexAttributes.tangent,j=new Float64Array(a.length),x=t(p)?new Float32Array(p.length):null,A=t(d)?new Float32Array(d.length):null;f(a,i,j),t(p)&&g(p,a,j,i,x),t(d)&&m(d,a,j,i,A),y(j,r,s),u(j,a,i),t(p)&&h(x,a,j,i,p),t(d)&&v(A,a,j,i,d),e.vertexAttributesChanged()}function b(e,t,r){const o=R;if(!c(r,o,e.spatialReference)){const t=e.origin;o[0]=t.x,o[1]=t.y,o[2]=t.z,d.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}y(e.vertexAttributes.position,t,o),e.vertexAttributesChanged()}function y(e,t,r=a){if(e)for(let o=0;o<e.length;o+=3){for(let t=0;t<3;t++)w[t]=e[o+t]-r[t];i(w,w,t);for(let t=0;t<3;t++)e[o+t]=w[t]+r[t]}}const w=s(),k=s(),R=s();export{j as scale};
