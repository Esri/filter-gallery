/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import"../../../geometry.js";import e from"../../../Ground.js";import{unwrapOr as t}from"../../../core/maybe.js";import{eachAlways as o}from"../../../core/promiseUtils.js";import{getMetersPerUnitForSR as n}from"../../../core/unitUtils.js";import r from"../../Mesh.js";import i from"../MeshComponent.js";import{MeshVertexAttributes as a}from"../MeshVertexAttributes.js";import s from"../../Point.js";async function m(t,o,n){let r;if(p(t)||t instanceof e){const e=await c(t);r=await e.createElevationSampler(o,{demResolution:n&&n.demResolution||"finest-contiguous"})}else r=t;return l(r,o,n)}function l(e,o,s){const m=n(o.spatialReference),l=e.demResolution.min/m,c=Math.round(o.width/l),p=Math.round(o.height/l),u=c+1,h=p+1,w=new Float64Array(u*h*3),y=new Float32Array(u*h*2);let d=0,j=0;const R=new Uint32Array(c*p*2*3);let v=0,A=0;f.spatialReference=o.spatialReference;for(let n=0;n<h;n++){const r=o.ymin+o.height*(n/p);for(let i=0;i<u;i++){const a=o.xmin+o.width*(i/c);f.x=a,f.y=r,w[d++]=a,w[d++]=r,w[d++]=t(e.elevationAt(f),0);const s=i/c,m=n/p;y[j++]=s,y[j++]=m,n!==p&&i!==c&&(R[A++]=v+1,R[A++]=v+u+1,R[A++]=v+u,R[A++]=v,R[A++]=v+1,R[A++]=v+u),v++}}return new r({vertexAttributes:new a({position:w,uv:y}),components:[new i({faces:R,shading:"smooth",material:s&&s.material||null})],spatialReference:o.spatialReference})}async function c(e){return p(e)?e.load():(await e.load(),await o(e.layers.map((e=>e.load()))),e)}function p(e){return"type"in e&&("elevation"===e.type||"base-elevation"===e.type)}const f=new s;export{m as create};
