/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import r from"../../PopupTemplate.js";import t from"../../renderers/ClassBreaksRenderer.js";import"../../renderers/DictionaryRenderer.js";import"../../renderers/DotDensityRenderer.js";import"../../renderers/HeatmapRenderer.js";import o from"../../renderers/Renderer.js";import i from"../../renderers/SimpleRenderer.js";import n from"../../renderers/UniqueValueRenderer.js";import{read as s}from"../../renderers/support/jsonUtils.js";import{webSceneRendererTypes as l}from"../../renderers/support/types.js";import{symbolTypesRenderer as p}from"../../symbols.js";import{HandleOwnerMixin as a}from"../../core/HandleOwner.js";import{IdentifiableMixin as d}from"../../core/Identifiable.js";import m from"../../core/Loadable.js";import y from"../../core/Logger.js";import{MultiOriginJSONMixin as u}from"../../core/MultiOriginJSONSupport.js";import{property as f}from"../../core/accessorSupport/decorators/property.js";import"../../core/arrayUtils.js";import"../../core/has.js";import"../../core/accessorSupport/ensureType.js";import{reader as c}from"../../core/accessorSupport/decorators/reader.js";import{subclass as b}from"../../core/accessorSupport/decorators/subclass.js";import{createTypeReader as g}from"../../core/accessorSupport/extensions/serializableProperty/reader.js";import{labelsVisible as j,legendEnabled as v,minScale as S,maxScale as w,opacityDrawingInfo as I,popupEnabled as h}from"./commonProperties.js";import D from"./FeatureTemplate.js";import R from"./LabelClass.js";import{reader as T}from"./labelingInfo.js";import{createPopupTemplate as V}from"../../support/popupUtils.js";const x=y.getLogger("esri.layers.FeatureLayer"),P=g({types:p}),O={key:"type",base:o,typeMap:{simple:i,"unique-value":n,"class-breaks":t},errorContext:"renderer"};let C=class extends(a(u(d(m)))){constructor(e){super(e),this.type="subtype-sublayer",this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.subtypeCode=null,this.templates=null,this.title=null,this.visible=!0}get effectiveScaleRange(){const{minScale:e,maxScale:r}=this;return{minScale:e,maxScale:r}}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){this._set("renderer",e)}readRenderer(e,r,t){const o=(r=r.layerDefinition||r).drawingInfo&&r.drawingInfo.renderer||void 0;if(o){const e=s(o,r,t)||void 0;return e||x.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:t}),e}if(r.defaultSymbol)return r.types&&r.types.length?new n({defaultSymbol:P(r.defaultSymbol,r,t),field:r.typeIdField,uniqueValueInfos:r.types.map((e=>({id:e.id,symbol:P(e.symbol,e,t)})))}):new i({symbol:P(r.defaultSymbol,r,t)})}readTemplates(e,r){return e=e&&e.map((e=>D.fromJSON(e)))}readVisible(e,r){return r.layerDefinition&&null!=r.layerDefinition.defaultVisibility?!!r.layerDefinition.defaultVisibility:null!=r.visibility?!!r.visibility:void 0}createPopupTemplate(e){const r=this.parent.fields;return V({...this,fields:r},e)}};e([f({json:{read:!1}})],C.prototype,"type",void 0),e([f(j)],C.prototype,"labelsVisible",void 0),e([f({type:[R],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:T},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:T},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],C.prototype,"labelingInfo",void 0),e([f(v)],C.prototype,"legendEnabled",void 0),e([f(S)],C.prototype,"minScale",void 0),e([f(w)],C.prototype,"maxScale",void 0),e([f({readOnly:!0})],C.prototype,"effectiveScaleRange",null),e([f(I)],C.prototype,"opacity",void 0),e([f()],C.prototype,"parent",void 0),e([f(h)],C.prototype,"popupEnabled",void 0),e([f({type:r,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],C.prototype,"popupTemplate",void 0),e([f({readOnly:!0})],C.prototype,"defaultPopupTemplate",null),e([f({types:O,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:l,write:{overridePolicy:(e,r,t)=>({ignoreOrigin:null==t?void 0:t.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,r,t)=>({ignoreOrigin:null==t?void 0:t.writeLayerSchema})}}})],C.prototype,"renderer",null),e([c("service","renderer",["drawingInfo.renderer","defaultSymbol"]),c("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],C.prototype,"readRenderer",null),e([f({type:Number,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.subtypeCode"},write:{target:"layerDefinition.subtypeCode"}}})],C.prototype,"subtypeCode",void 0),e([f({type:[D]})],C.prototype,"templates",void 0),e([c("templates",["editFieldsInfo","creatorField","editorField","templates"])],C.prototype,"readTemplates",null),e([f()],C.prototype,"title",void 0),e([f({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],C.prototype,"visible",void 0),e([c("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],C.prototype,"readVisible",null),C=e([b("esri.layers.support.SubtypeSublayer")],C);const F=C;export{F as default};
