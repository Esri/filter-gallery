/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{setDeepValue as t}from"../../core/object.js";import{parse as r}from"./parser.js";import{isEffectFunctions as s}from"./utils.js";function n(e,t,r){try{return c(e)}catch(n){var s;null==r||null==(s=r.messages)||s.push(n)}return null}function a(e,r,s,n){try{const n=o(e);t(s,n,r)}catch(a){n.messages&&n.messages.push(a)}}function o(e){const t=r(e);return t?s(t)?t.map((e=>e.toJSON())):t.map((({scale:e,effects:t})=>({scale:e,value:t.map((e=>e.toJSON()))}))):null}function c(e){if(!e||0===e.length)return null;if(u(e)){const t=[];for(const r of e)t.push({scale:r.scale,value:f(r.value)});return t}return f(e)}function u(e){const t=e[0];return!!t&&"scale"in t}function f(e){if(!e||!e.length)return"";const t=[];for(const s of e){let e=[];switch(s.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":e=[i(s,"amount")];break;case"blur":e=[i(s,"radius","pt")];break;case"hue-rotate":e=[i(s,"angle","deg")];break;case"drop-shadow":e=[i(s,"xoffset","pt"),i(s,"yoffset","pt"),i(s,"blurRadius","pt"),l(s,"color")];break;case"bloom":e=[i(s,"strength"),i(s,"radius","pt"),i(s,"threshold")]}const n=`${s.type}(${e.filter(Boolean).join(" ")})`;r(n),t.push(n)}return t.join(" ")}function i(t,r,s){if(null==t[r])throw new e("effect:missing-parameter",`Missing parameter '${r}' in ${t.type} effect`,{effect:t});return s?t[r]+s:""+t[r]}function l(t,r){if(null==t[r])throw new e("effect:missing-parameter",`Missing parameter '${r}' in ${t.type} effect`,{effect:t});const s=t[r];return`rgba(${s[0]||0}, ${s[1]||0}, ${s[2]||0}, ${s[3]/255||0})`}export{f as effectFunctionsFromJSON,c as fromJSON,n as read,o as toJSON,a as write};
