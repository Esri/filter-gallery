/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{px2pt as e}from"../../core/screenUtils.js";import{getSize as r,getColor as t,getOpacity as n,getRotationAngle as i}from"../../renderers/visualVariables/support/visualVariableUtils.js";const o="simple-marker",u="picture-marker",a="simple-line",l="simple-fill",s="shield-label-symbol",f="text";function y(y,c){const{graphic:p,renderer:m,symbol:g}=c,d=g.type;if(d===f||d===s||!("visualVariables"in m)||!m.visualVariables)return;const b=m.getVisualVariablesForType("size"),h=m.getVisualVariablesForType("color"),w=m.getVisualVariablesForType("opacity"),V=m.getVisualVariablesForType("rotation"),T=b[0],v=h[0],G=w[0],k=V[0];if(T){const t=d===o?g.style:null,n=r(T,p,{shape:t});null!=n&&(d===o?y.size=e(n):d===u?(y.width=e(n),y.height=e(n)):d===a?y.width=e(n):y.outline&&(y.outline.width=e(n)))}if(v){const e=t(v,p);(e&&d===o||d===a||d===l)&&(y.color=e?e.toJSON():void 0)}if(G){const e=n(G,p);null!=e&&y.color&&(y.color[3]=Math.round(255*e))}k&&(y.angle=-i(m,p))}function c(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function p(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function m(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function g(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function d(e,r=15){const t=e.canvas.width,n=e.canvas.height,i=e.getImageData(0,0,t,n).data;let o,u,a,l,s,f;e:for(u=n;u--;)for(o=t;o--;)if(i[4*(t*u+o)+3]>r){f=u;break e}if(!f)return null;e:for(o=t;o--;)for(u=f+1;u--;)if(i[4*(t*u+o)+3]>r){s=o;break e}e:for(o=0;o<=s;++o)for(u=f+1;u--;)if(i[4*(t*u+o)+3]>r){a=o;break e}e:for(u=0;u<=f;++u)for(o=a;o<=s;++o)if(i[4*(t*u+o)+3]>r){l=u;break e}return{x:a,y:l,width:s-a,height:f-l}}function b(e,r){const t=e.allLayerViews.items;if(r===e.scale)return t.filter((e=>!e.suspended));const n=new Array;for(const i of t)S(i.parent)&&!n.includes(i.parent)||!i.visible||r&&"isVisibleAtScale"in i&&!i.isVisibleAtScale(r)||n.push(i);return n}function h(e){return e&&"bing-maps"===e.type}function w(e){return e&&"blendMode"in e&&"effect"in e}function V(e){return e&&"csv"===e.type}function T(e){return e&&"feature"===e.type}function v(e){return e&&"geojson"===e.type}function G(e){return e&&"graphics"===e.type}function k(e){return e&&"group"===e.type}function S(e){return e&&"esri.views.2d.layers.GroupLayerView2D"===e.declaredClass}function D(e){return e&&"imagery"===e.type}function L(e){return e&&"imagery-tile"===e.type}function P(e){return e&&"kml"===e.type}function I(e){return e&&"map-image"===e.type}function M(e){return e&&"map-notes"===e.type}function F(e){return e&&"open-street-map"===e.type}function j(e){const r=e.layer;if(w(r)){const t=r.blendMode;if((!t||"normal"===t)&&(r.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}function x(e){return e&&"stream"===e.type}function A(e){return e&&"tile"===e.type}function z(e){return e&&"vector-tile"===e.type}function E(e){return e&&"web-tile"===e.type}function U(e){return e&&"wms"===e.type}function C(e){return e&&"wmts"===e.type}export{y as applyVisualVariables,c as createMultipointLayer,m as createPointLayer,p as createPolygonLayer,g as createPolylineLayer,d as getContextBoundingBox,b as getVisibleLayerViews,h as isBingMapsLayer,w as isBlendLayer,V as isCSVLayer,T as isFeatureLayer,v as isGeoJSONLayer,G as isGraphicsLayer,k as isGroupLayer,D as isImageryLayer,L as isImageryTileLayer,P as isKMLLayer,I as isMapImageLayer,M as isMapNotesLayer,F as isOpenStreetMapLayer,j as isScreenshotRequired,x as isStreamLayer,A as isTileLayer,z as isVectorTileLayer,U as isWMSLayer,C as isWMTSLayer,E as isWebTileLayer};
