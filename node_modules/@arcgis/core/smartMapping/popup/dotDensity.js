/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import e from"../../PopupTemplate.js";import t from"../../core/Error.js";import{fetchMessageBundle as n}from"../../intl/messages.js";import i from"../../popup/ExpressionInfo.js";import o from"../../popup/FieldInfo.js";import{getFieldAndExpressionInfos as s,getContentFromFieldInfos as r,expressionFieldPrefix as a}from"./support/utils.js";import{getArcadeForOrderedFields as f,getArcadeForPredominantCategoryAlias as d}from"../statistics/support/predominanceUtils.js";async function p(e){const{layer:n,renderer:i}=e;await n.load();const o=i||n.renderer;if("dot-density"!==o.type)throw new t("dot-density-popup:invalid-parameters","renderer.type must be 'dot-density'");return{layer:n,renderer:o}}async function l(t,n){const{fieldInfos:i,expressionInfos:o}=await s({renderer:t,layer:n});return new e({content:await r(n,{fieldInfos:i,expressionInfos:o}),expressionInfos:o,fieldInfos:i})}async function m(t,n,r){const{fieldInfos:d,expressionInfos:p}=await s({renderer:t,layer:n}),l=d.filter((e=>-1===e.fieldName.indexOf(a))),m={fieldInfo:new o({fieldName:"expression/dot-density-categories-list"}),expressionInfo:new i({name:"dot-density-categories-list",title:r.listOfCategories,expression:f(l,p)})},y=new e({expressionInfos:[m.expressionInfo],fieldInfos:[m.fieldInfo],title:r.competingFields,content:`{${m.fieldInfo.fieldName}}`});return{name:"dot-density-categories-list",title:r.orderedListOfValues,value:y}}async function y(t,n,r){const{fieldInfos:f,expressionInfos:p}=await s({renderer:t,layer:n}),l=f.filter((e=>-1===e.fieldName.indexOf(a))),m={fieldInfo:new o({fieldName:"expression/dot-density-category"}),expressionInfo:new i({name:"dot-density-category",title:r.predominantCategory,expression:d(l,p)})},y=new e({expressionInfos:[m.expressionInfo,...p],fieldInfos:[m.fieldInfo,...f],content:[{type:"text",text:`<div><b><font size="3">{${m.fieldInfo.fieldName}}</font></b></div>`},{type:"media",mediaInfos:{type:"pie-chart",title:r.competingFields,value:{fields:f.map((e=>e.fieldName))}}}]});return{name:"dot-density-category-chart",title:r.predominantCategoryWithChart,value:y}}async function c(e){const[{renderer:t,layer:i},o]=await Promise.all([p(e),n("esri/smartMapping/t9n/smartMapping")]);return{primaryTemplate:{name:"dot-density",title:o.dotDensity,value:await l(t,i)},secondaryTemplates:[await m(t,i,o),await y(t,i,o)]}}export{c as getTemplates};
