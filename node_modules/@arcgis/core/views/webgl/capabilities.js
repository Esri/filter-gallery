/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{isNone as e,isSome as t}from"../../core/maybe.js";import{ContextType as r,createContext as n}from"./context-util.js";let s,a;function o(e){switch(e){case r.WEBGL1:return i();case r.WEBGL2:return u()}}function i(){return s||(s=m()),s}function u(){return a||(a=d()),a}class c{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1}}class l extends c{constructor(){super(...arguments),this.type=r.WEBGL1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1}}class p extends c{constructor(){super(...arguments),this.type=r.WEBGL2}}function E(s,a){if(s===r.WEBGL1&&void 0===typeof WebGLRenderingContext||s===r.WEBGL2&&void 0===typeof WebGL2RenderingContext)return null;const o=document.createElement("canvas");if(!o)return null;let i=n(o,s,{failIfMajorPerformanceCaveat:!0});if(e(i)&&(i=n(o,s),t(i)&&(a.majorPerformanceCaveat=!0)),e(i))return i;if(s===r.WEBGL1){const e=i.getParameter(i.VERSION),t=null==e?void 0:e.match(/^WebGL\s+([\d.]*)/);if(t){const e=parseFloat(t[1]);a.available=e>=.94}}else a.available=!0;a.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),a.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const u=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return u&&(a.supportsHighPrecisionFragment=u.precision>0),i}function m(){const t=new l,n=E(r.WEBGL1,t);return e(n)||(t.supportsElementIndexUint=null!==n.getExtension("OES_element_index_uint"),t.supportsStandardDerivatives=null!==n.getExtension("OES_standard_derivatives"),t.supportsInstancedArrays=null!==n.getExtension("ANGLE_instanced_arrays"),t.supportsTextureFloat=null!==n.getExtension("OES_texture_float")),t}function d(){const t=new p,n=E(r.WEBGL2,t);return e(n),t}export{l as WebGL1Capabilities,p as WebGL2Capabilities,i as getWebGL1Capabilities,u as getWebGL2Capabilities,o as getWebGLCapabilities};
