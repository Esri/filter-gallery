/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{isSome as e}from"../../core/maybe.js";import{createResolver as i}from"../../core/promiseUtils.js";import{whenOnce as r}from"../../core/reactiveUtils.js";import{debug as n}from"../../core/scheduling.js";import{dispatch as o}from"../../core/accessorSupport/watch.js";function t(e){switch(e.type){case"2d":return a(e);case"3d":if(e)return o(),n.dispatch(),r((()=>!e.updating))}return Promise.resolve()}function a(r){const t=i();let a=performance.now();const s=function(){var i,t,a,s,l,u,c;if(o(),n.dispatch(),!r.ready||r.updating||!r.stationary||r.rendering||!0===(null==(i=r.layerViewManager)?void 0:i.updating)||!0===(null==(t=r.labelManager)?void 0:t.updating)||!0===(null==(a=r.graphicsView)?void 0:a.updating)||!0===(null==(s=r.magnifier)?void 0:s.visible)&&e(null==(l=r.magnifier)?void 0:l.position)&&(null==(u=r._magnifierView)||!u.mask||null==(c=r._magnifierView)||!c.overlay)||r.allLayerViews.some((e=>!0===e.updating)))return!0;return!!r.allLayerViews.find((function(e){const i=!e.isFulfilled(),r=e.updating&&!e.suspended;return i||r}))};function l(){if(!r.destroyed&&s())a=null,setTimeout(l,16);else{a||(a=performance.now());performance.now()-a>=200?t():setTimeout(l,16)}}return setTimeout(l,16),t.promise}export{t as default};
