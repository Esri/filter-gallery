/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../../chunks/tslib.es6.js";import t from"../../../../../../core/Accessor.js";import{HandleOwnerMixin as r}from"../../../../../../core/HandleOwner.js";import{isSome as i,isNone as o}from"../../../../../../core/maybe.js";import{property as s}from"../../../../../../core/accessorSupport/decorators/property.js";import"../../../../../../core/arrayUtils.js";import"../../../../../../core/has.js";import"../../../../../../core/accessorSupport/ensureType.js";import{subclass as l}from"../../../../../../core/accessorSupport/decorators/subclass.js";import{distanceToTile as n}from"../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils.js";import{scaleBoundsPredicate as a}from"../../../../../support/layerViewUtils.js";let c=class extends(r(t)){constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,t=i(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort(((e,r)=>n(t,e)-n(t,r))),e}_scaleEnabled(){return a(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||o(this.tileInfo))return[];if(!this._scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:r}=t,i=[];for(const{row:o,colFrom:s,colTo:l}of e)for(let e=s;e<=l;e++){const s={id:null,level:r,row:o,col:t.normalizeCol(e)};this.tileInfo.updateTileInfo(s),i.push(s)}return i}get tileInfo(){var e,t;return null!=(e=null==(t=this.view.featuresTilingScheme)?void 0:t.tileInfo)?e:null}get tileSize(){return i(this.tileInfo)?this.tileInfo.size[0]:256}initialize(){this.handles.add(this.watch("view.state.viewpoint",(()=>this.notifyChange("tilesCoveringView")),!0))}};e([s({readOnly:!0})],c.prototype,"tiles",null),e([s({readOnly:!0})],c.prototype,"_scaleEnabled",null),e([s({readOnly:!0})],c.prototype,"tilesCoveringView",null),e([s({readOnly:!0})],c.prototype,"tileInfo",null),e([s({readOnly:!0})],c.prototype,"tileSize",null),e([s({constructOnly:!0})],c.prototype,"view",void 0),e([s({constructOnly:!0})],c.prototype,"layer",void 0),e([s()],c.prototype,"pointOfInterest",void 0),c=e([l("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],c);export{c as FeatureServiceTiles2D};
