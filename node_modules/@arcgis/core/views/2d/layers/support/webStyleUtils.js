/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{isDevEnvironment as t,adjustStaticAGOUrl as r}from"../../../../core/devEnvironmentUtils.js";import e from"../../../../core/Error.js";import{throwIfAborted as o}from"../../../../core/promiseUtils.js";import{urlToObject as n}from"../../../../core/urlUtils.js";import s from"../../../../portal/Portal.js";import{f as l}from"../../../../chunks/persistableUrlUtils.js";import{fetchStyle as m,Style2DUrlTemplate as a,requestJSON as i,makeCIMSymbolRef as c,symbolUrlFromStyleItem as u}from"../../../../symbols/support/styleUtils.js";async function y(t,r,n){if(!t.name)return Promise.reject(new e("style-symbol-reference-name-missing","Missing name in style symbol reference"));if(t.styleName&&"Esri2DPointSymbolsStyle"===t.styleName)return f(t,n);try{return p(await m(t,r,n),t.name,r,n)}catch(s){return o(s),null}}async function f(t,r){const e=a.replace(/\{SymbolName\}/gi,t.name);try{const t=await i(e,r);return c(t.data)}catch(n){return o(n),null}}async function p(m,a,y,f){const p=m.data,b={portal:y&&y.portal||s.getDefault(),url:n(m.baseUrl),origin:"portal-item"},d=p.items.find((t=>t.name===a));if(!d){throw new e("symbolstyleutils:symbol-name-not-found",`The symbol name '${a}' could not be found`,{symbolName:a})}let j=l(u(d,"cimRef"),b);t()&&(j=r(j));try{const t=await i(j,f);return c(t.data)}catch(U){return o(U),null}}export{y as fetchCIMSymbolReference};
