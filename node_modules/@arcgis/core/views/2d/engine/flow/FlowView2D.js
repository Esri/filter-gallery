/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../chunks/tslib.es6.js";import e from"../../../../Graphic.js";import{HandleOwner as r}from"../../../../core/HandleOwner.js";import{watch as i}from"../../../../core/reactiveUtils.js";import{property as s}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/arrayUtils.js";import"../../../../core/has.js";import"../../../../core/accessorSupport/ensureType.js";import{subclass as o}from"../../../../core/accessorSupport/decorators/subclass.js";import{loadImagery as a}from"./dataUtils.js";import n from"./FlowContainer.js";import l from"./FlowStrategy.js";import p from"./FlowStyle.js";let h=class extends r{constructor(){super(...arguments),this._loadImagery=(t,e,r,i,s)=>a(this.layer,t,e,r,i,s),this._createStreamlinesMesh=(t,e,r)=>this.layer.createStreamlinesMesh({flowData:e,rendererSettings:t},{signal:r}),this.attached=!1,this.container=null,this.layer=null,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this._strategy||this._strategy.updating}attach(){const{layer:t}=this,e=()=>{this._loadImagery=(e,r,i,s,o)=>a(t,e,r,i,s,o),this._updateVisualization()};"multidimensionalDefinition"in t?this.handles.add(i((()=>t.multidimensionalDefinition),e)):this.handles.add([i((()=>t.mosaicRule),e),i((()=>t.renderingRule),e),i((()=>t.definitionExpression),e)]),this.container=new n,this._strategy=new l({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}update(t){t.stationary?this._strategy.update(t):this.layerView.requestUpdate()}hitTest(t){return new e({attributes:{},geometry:t.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){if("flow"!==this.layer.renderer.type)return;const t=new p(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer,this.timeExtent);this.container.flowStyle=t,this.layerView.requestUpdate()}};t([s()],h.prototype,"_strategy",void 0),t([s()],h.prototype,"attached",void 0),t([s()],h.prototype,"container",void 0),t([s()],h.prototype,"layer",void 0),t([s()],h.prototype,"layerView",void 0),t([s()],h.prototype,"type",void 0),t([s()],h.prototype,"updating",null),t([s()],h.prototype,"timeExtent",void 0),h=t([o("esri.views.2d.engine.flow.FlowView2D")],h);const d=h;export{d as default};
