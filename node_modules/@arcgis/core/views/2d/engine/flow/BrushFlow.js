/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{isNone as e}from"../../../../core/maybe.js";import t from"../webgl/brushes/WGLBrush.js";import{CompareFunction as n,BlendFactor as r,PrimitiveType as a,DataType as s}from"../../../webgl/enums.js";class i extends t{dispose(){}prepareState(e){const{context:t}=e;t.setColorMask(!0,!0,!0,!0),t.setStencilFunction(n.EQUAL,0,255)}draw(t,n){const{context:i}=t,{displayData:o}=n;if(e(o))return;if("loaded"===o.state.name&&o.prepareForRendering(i),"attached"!==o.state.name)return;const f=o.state.resources;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE);const d=[];"ramp"===f.values.lineColor.kind&&d.push("vvLineColor"),"ramp"===f.values.lineOpacity.kind&&d.push("vvLineOpacity"),"ramp"===f.values.lineRenderWidth.kind&&d.push("vvLineRenderWidth");const u=t.painter.materialManager.getProgram(t,{vsPath:"raster/flow",fsPath:"raster/flow",attributes:f.locations},d);i.useProgram(u),u.setUniform1f("u_time",t.time/1e3),u.setUniform1f("u_fadeDuration",o.flowStyle.renderSettings.fadeDuration),u.setUniform1f("u_lineSpeed",o.flowStyle.renderSettings.lineSpeed),u.setUniformMatrix3fv("u_dvsMat3",n.transforms.dvs),u.setUniformMatrix3fv("u_displayViewMat3",t.state.displayViewMat3),l(u,"lineColor","vec4",o.flowStyle.renderSettings.lineColor),l(u,"lineOpacity","float",o.flowStyle.renderSettings.lineOpacity),l(u,"lineRenderWidth","float",o.flowStyle.renderSettings.lineRenderWidth),i.bindVAO(f.vertexArray),i.drawElements(a.TRIANGLES,f.indexBuffer.size,s.UNSIGNED_INT,0),o.flowStyle.animated&&n.requestRender()}}function o(e,t,n,r){switch(t){case"int":e.setUniform1iv(n,r);break;case"float":e.setUniform1fv(n,r);break;case"vec2":e.setUniform2fv(n,r);break;case"vec3":e.setUniform3fv(n,r);break;case"vec4":e.setUniform4fv(n,r)}}function l(e,t,n,r){"constant"===r.kind?o(e,n,`u_${t}`,r.value):(o(e,"float",`u_${t}_stops`,r.stops),o(e,n,`u_${t}_values`,r.values),o(e,"int",`u_${t}_count`,[r.count]))}export{i as default};
