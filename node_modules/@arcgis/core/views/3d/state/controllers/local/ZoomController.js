/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../chunks/tslib.es6.js";import{clamp as i}from"../../../../../core/mathUtils.js";import{createScreenPointArray as r}from"../../../../../core/screenUtils.js";import{property as s}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/arrayUtils.js";import"../../../../../core/has.js";import"../../../../../core/accessorSupport/ensureType.js";import{subclass as e}from"../../../../../core/accessorSupport/decorators/subclass.js";import{c as a}from"../../../../../chunks/vec2.js";import{a as o}from"../../../../../chunks/vec2f64.js";import{f as n,n as m,a as h,b as c,o as p,g as l,l as u,e as P}from"../../../../../chunks/vec3.js";import{c as C}from"../../../../../chunks/vec3f64.js";import{create as v,fromPositionAndNormal as f}from"../../../../../geometry/support/plane.js";import{pixelDistanceToInteractionFactor as y,applyAll as D}from"../../../camera/constraintUtils.js";import{ConstraintTypes as d,InteractionType as g,TiltMode as j}from"../../../camera/constraintUtils/common.js";import{InteractiveController as w}from"../InteractiveController.js";import{normalizeCoordinate as O,DISTANCE_CLAMP_VALUES as M,PIVOT_DISTANCE_MODIFIER as N,SCREEN_PIXEL_AREA as b,intersectPlaneFromScreenPoint as R}from"../../utils/navigationUtils.js";let S=class extends w{constructor(t){super(t),this.view=null,this.tmpP=C(),this.tmpDir=C(),this.tmpN=C(),this.tmpP0=o(),this.tmpPoi=C(),this.tmpRayDir=C(),this.dragBeginPoint=r(),this.normalizedAnchorPoint=o(),this.constraintOptions={selection:d.ALL,interactionType:g.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:C(),tiltMode:j.TUMBLE},this.plane=v()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(t){if(!this.active)return;let r;a(this.dragBeginPoint,t),O(this.startCamera,t,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(t,this.tmpP),n(this.tmpDir,this.tmpP,this.startCamera.eye),m(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=i(N*r,M[0],M[1]);const e=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),t[0],t[1],this.view.state.camera,b);s=s>e?e:s,h(this.tmpDir,this.tmpDir,s),c(this.tmpP,this.startCamera.eye,this.tmpDir),n(this.tmpN,this.startCamera.eye,this.startCamera.center),m(this.tmpN,this.tmpN),this.tmpN[1]<0&&p(this.tmpN,this.tmpN),f(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(t){if(!this.active)return;R(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||l(this.tmpPoi,this.currentCamera.center),O(this.currentCamera,t,this.tmpP0);let i=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);a(this.normalizedAnchorPoint,this.tmpP0),n(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const r=u(this.tmpRayDir);let s=r*(1-i);l(this.constraintOptions.interactionDirection,this.tmpRayDir),h(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(i)/r);const e=this.view.state.constraints.minimumPoiDistance;i>=0&&s<e&&(s=e,i=-(s-r)/r),Math.abs(r-s)<1e-6||(h(this.tmpRayDir,this.tmpRayDir,i),this.currentCamera.eye=c(U,this.currentCamera.eye,this.tmpRayDir),P(U,this.currentCamera.center,this.tmpPoi,i),this.tmpPoi[2]>this.startCamera.center[2]?U[2]=Math.max(this.startCamera.center[2],U[2]):U[2]=Math.min(this.startCamera.center[2],U[2]),this.currentCamera.center=U,this.constraintOptions.interactionFactor=y(this.dragBeginPoint,t),D(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};t([s({constructOnly:!0})],S.prototype,"view",void 0),S=t([e("esri.views.3d.state.controllers.local.ZoomController")],S);const U=C();export{S as ZoomController};
