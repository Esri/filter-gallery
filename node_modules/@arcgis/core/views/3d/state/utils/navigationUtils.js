/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{deg2rad as t,clamp as e,acosClamped as n}from"../../../../core/mathUtils.js";import{isNone as o}from"../../../../core/maybe.js";import{createScreenPointArray as r}from"../../../../core/screenUtils.js";import{d as a,m as s,e as i}from"../../../../chunks/mat4.js";import{c}from"../../../../chunks/mat4f64.js";import{s as m}from"../../../../chunks/vec2.js";import{a as u}from"../../../../chunks/vec2f64.js";import{g as p,d as l,a as f,f as h,n as M,c as y,m as g,b,l as d,e as j,s as v,h as z}from"../../../../chunks/vec3.js";import{c as x}from"../../../../chunks/vec3f64.js";import{create as P,axis as k,fromPoints as I,wrapAxisAngle as w}from"../../../../geometry/support/axisAngle.js";import{coordinateSystemFromOneAxisAndNormalVector as A,vectorCoordinates as H}from"../../../../geometry/support/coordinateSystem.js";import{create as U,intersectRay as E,fromNormalAndOffset as G}from"../../../../geometry/support/plane.js";import{h as S,e as V,c as q}from"../../../../chunks/sphere.js";import{angle as F}from"../../../../geometry/support/vector.js";import{sv3d as R,sm4d as C}from"../../../../geometry/support/vectorStacks.js";import{cyclicalPI as T}from"../../support/mathUtils.js";import{fromScreen as W,fromScreenAtEye as B}from"../../support/geometryUtils/ray.js";import{intersectScreen as D}from"../../support/geometryUtils/sphere.js";import J from"../../webgl-engine/lib/Camera.js";const K=30,L=[1,3e8],N=70;function O(t,e,n){return n[0]=e[0]/(t.fullWidth/t.pixelRatio),n[1]=e[1]/(t.fullHeight/t.pixelRatio),n}function Q(t,e,n){const o=R.get(),r=R.get(),a=R.get();p(r,t),p(a,e);const s=l(r,n),i=l(a,n);f(o,n,s),h(r,r,o),M(r,r),f(o,n,i),h(a,a,o),M(a,a);const c=l(r,a);y(o,n,r);const m=l(a,o);return Math.atan2(m,c)}function X(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function Y(t,e,n){const o=a(C.get(),n[3],k(n));h(Nt,t.eye,e),g(Nt,Nt,o),t.eye=b(Nt,Nt,e),h(Nt,t.center,e),g(Nt,Nt,o),t.center=b(Nt,Nt,e),t.up=g(Nt,t.up,o)}function Z(t,e,n,o){return E(t,W(e,n,Zt),o)}function $(t,e,n,o){return E(t,B(e,n,Zt),o)}function _(t,e,n,o){const r=R.get();let a=1-n;h(r,e,t.eye);const s=d(r);let i=s*(1-a);a>=0&&i<o&&(i=o,a=-(i-s)/s),Math.abs(s-i)<1e-6||(f(r,r,a),t.eye=b(Nt,t.eye,r),t.center=j(Nt,t.center,e,a))}function tt(t,e,n){e.getScreenCenter(et),D(t,e,et,Nt)&&(e.center=Nt);const o=e.distance,r=o*n;if(Math.abs(o-r)<1e-6)return;const a=f(R.get(),e.viewForward,r);e.eye=h(Nt,e.center,a)}const et=r();function nt(t,e,n){ot(e,n),M(n,n),f(n,n,t)}function ot(t,e){v(e,0,0,0);for(const n of t)b(e,e,n);f(e,e,1/t.length)}function rt(t,e,n,o){return Math.sin(t/d(e))*(n+o.radius)}function at(t,e,n,o){return rt(Math.PI/2,e,n,o)+(t-Math.PI/2)}var st;!function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"}(st||(st={}));const it={Elevation:3e4,Angle:t(6)},ct={Pole:.95,Angle:t(18),Tilt:45},mt=t(80);function ut(t,e,n,o,r){const a=x(),s=q();let i=!0,c=!0;return t.intersectScreen(n,a)?s[3]=d(a):(c=!1,e.aboveGround?s[3]=Math.max(d(e.center),.9*r.radius):s[3]=d(e.eye)-e.relativeElevation,o?ht(s,e,n,a):i=D(s,e,n,a)),{sphere:s,scenePickPoint:i?a:null,hasGeometryIntersection:c}}function pt(t,e,n,o){if(d(t.eye)-o.radius>it.Elevation)return st.Horizontal;if(!n)return st.Vertical;B(t,e,$t);return-Math.sign(t.relativeElevation)*(.5*Math.PI+F(t.eye,$t.direction))<it.Angle?st.Vertical:st.Horizontal}function lt(t,e,n){h(ft,n,e),t.eye=h(Nt,t.eye,ft),t.center=h(Nt,t.center,ft)}const ft=x();function ht(t,e,n,r){const a=B(e,n,Zt);return!o(a)&&(S(t,a,Mt),V(t,a,r)?!(z(Mt,a.origin)<z(r,a.origin))||(p(r,Mt),!1):(h(yt,e.eye,e.center),M(yt,yt),G(yt,-l(M(yt,yt),Mt),gt),E(gt,a,r),!1))}const Mt=x(),yt=x(),gt=U();function bt(o,r,a,s,i,c){let m;if(y(Xt,o,r),h(Ot,o,r),d(o)<=i||!s.aboveGround){y(a,Ot,s.eye);const u=l(o,r)/(d(o)*d(r)),p=Math.cos(e(T.normalize(t(c)),0,mt));m=-n(u)-Math.max(0,d(r)-i)/(p*i)}else h(dt,s.eye,s.center),y(a,Ot,dt),m=-d(Ot)/i;return M(a,a),f(a,a,d(Xt)),m}const dt=x();function jt(o,r,a,s){let i,c;const m=Math.cos(e(T.normalize(t(s)),0,mt));return i=r>a?-(r-a)/(m*a):r<-a?Math.PI-(r+a)/(m*a):n(r/a),c=o>a?-(o-a)/(m*a):o<-a?Math.PI-(o+a)/(m*a):n(o/a),(c-i)*a}function vt(t,e,n,o,r,a,s,i,c,u){const p=jt(t[2],e[2],s[3],c),f=u?jt(t[0],e[0],s[3],180):e[0]-t[0],h=Math.sin(i)*f-Math.cos(i)*p,y=Math.cos(i)*f+Math.sin(i)*p;M(Nt,r);const g=u?h/Math.sqrt(Math.abs(s[3]**2-l(n,Nt)**2)):h/s[3],b=y/Math.sqrt(Math.abs(s[3]**2-l(n,o)**2));m(a,g,b)}function zt(t,e,n,o,r,a,s,i,c,m){y(Xt,t,e),A(a.up,a.eye,qt,Ft,Rt),A([0,0,1],a.eye,Gt,St,Vt),p(n,St),p(o,Gt),M(n,n),f(n,n,d(Xt)),H(t,M(Ft,Ft),M(Rt,Rt),M(qt,qt),Ct),H(e,Ft,Rt,qt,Tt),vt(Ct,Tt,t,Gt,St,r,s,i,c,m)}function xt(t,e,n,o,r,i,c){a(Dt,r,o),a(Jt,c,i),s(Kt,Dt,Jt),h(e,t,n),g(e,e,Kt),b(e,e,n)}function Pt(t,e,n,o,r,i){a(Dt,o,n),a(Jt,i,r),s(Kt,Dt,Jt),h(Nt,t.eye,e),g(Nt,Nt,Kt),t.eye=b(Nt,Nt,e),h(Nt,t.center,e),g(Nt,Nt,Kt),t.center=b(Nt,Nt,e),h(Nt,t.up,e),g(Nt,Nt,Kt),t.up=b(Nt,Nt,e)}function kt(t,e,n,o,r,a,s=ct.Pole,i=ct.Angle){const c=Math.abs(o)>Math.PI-i||Math.abs(o)<i,m=Math.abs(t[2])<n*s||Math.abs(e)>n;return!!(c&&m&&a.aboveGround&&r<ct.Tilt)}function It(t,e,n,o,r,a){if(a)I(n,o,Bt),Y(e,t,Bt);else{const a=bt(n,o,Yt,e,t[3],r);Y(e,t,w(Yt,a))}}function wt(t,e,n,o,r,a,s){const i=s?20:1,c=1e-12;let m,u;p(Lt,o),Qt.copyFrom(e);for(let p=0;p<i&&z(n,Lt)>c&&(m=z(n,Lt),zt(n,Lt,St,Gt,Wt,Qt,t,r,a,s),Pt(Qt,t,Gt,Wt[1],St,Wt[0]),xt(Lt,Lt,t,Gt,Wt[1],St,Wt[0]),u=z(n,Lt),u<m||0===p);p++)e.copyFrom(Qt)}function At(e,n,o,r,a,s,i){kt(o,l(n.up,o),e[3],-T.normalize(t(a)),s,n,ct.Pole,ct.Angle)?wt(e,n,o,r,-T.normalize(t(a)),s,i):It(e,n,o,r,s,i)}function Ht(t,e,n,o,r,a){const{eye:s}=t;A([0,0,1],s,Gt,St,Vt);const c=e.translation[0]*n.pan,m="zoom"===r.mode?0:e.translation[1]*n.pan,u=Math.max(Math.sqrt(Math.abs(1-l(t.center,Gt)**2/d(t.center)**2)),.5),p=(Math.sin(a)*m+Math.cos(a)*c)/u,f=-Math.cos(a)*m+Math.sin(a)*c;switch(i(o.pan.matrix,o.pan.matrix,p,Gt),o.pan.enabled=!0,r.mode){case"pan":i(o.pan.matrix,o.pan.matrix,f,St),o.pan.enabled=!0;break;case"zoom":o.zoom=-e.translation[1]*n.zoom}}function Ut(t,e,n,o,r){const{eye:a,viewRight:s}=t,c=y(R.get(),s,a),m=e.translation[0]*n.pan;switch(0!==m&&(i(o.pan.matrix,o.pan.matrix,-m,c),o.pan.enabled=!0),r.mode){case"pan":{const t=e.translation[1]*n.pan;0!==t&&(i(o.pan.matrix,o.pan.matrix,t,s),o.pan.enabled=!0);break}case"zoom":o.zoom=-e.translation[1]*n.zoom}}function Et(e,n,o,r,a,s,i,c,m){kt(e.center,l(e.up,e.center),d(e.center),-T.normalize(t(s)),i,n)?Ht(n,o,r,c,m,-T.normalize(t(a))):Ut(n,o,r,c,m)}const Gt=x(),St=x(),Vt=x(),qt=x(),Ft=x(),Rt=x(),Ct=x(),Tt=x(),Wt=u(),Bt=P(),Dt=c(),Jt=c(),Kt=c(),Lt=x(),Nt=x(),Ot=x(),Qt=new J,Xt=x(),Yt=x(),Zt={origin:x(),direction:x()},$t={origin:x(),direction:x()};export{L as DISTANCE_CLAMP_VALUES,st as NavigationMode,K as PIVOT_DISTANCE_MODIFIER,ct as PreservingHeadingThreshold,N as SCREEN_PIXEL_AREA,mt as TiltThresholdPanningSpeed,it as VerticalPanTresholds,lt as applyPanPlanar,It as applyPanSphericalDirectRotation,wt as applyPanSphericalPreserveHeading,Y as applyRotation,Pt as applyRotationWithTwoAxes,tt as applyZoomOnSphere,_ as applyZoomToPoint,ot as centroid,nt as centroidOnSphere,pt as decideNavigationMode,Z as intersectPlaneFromScreenPoint,$ as intersectPlaneFromScreenPointAtEye,jt as lengthFromPoints,O as normalizeCoordinate,X as normalizeRotationDelta,at as offSurfaceTiltToEyeTiltGlobal,rt as onSurfaceTiltToEyeTiltGlobal,Et as panMotionToRotationMatrix,At as panToPosition,ut as pickPointAndInitSphere,kt as preserveHeadingThreshold,xt as rotatePointAroundTwoAxes,bt as rotationAngleAndAxisDirectRotation,zt as rotationAnglesAndAxesHeadingPreserving,vt as rotationAnglesHeadingPreserving,Q as rotationFromPointsAroundAxis,ht as sphereOrPlanePointFromScreenPoint};
