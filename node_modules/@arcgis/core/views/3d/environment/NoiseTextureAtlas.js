/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import e from"../../../core/has.js";import{releaseMaybe as t,disposeMaybe as i,isNone as r}from"../../../core/maybe.js";import{NoiseTextureAtlasTechnique as s}from"./NoiseTextureAtlasTechnique.js";import{createQuadVAO as o}from"../webgl-engine/lib/glUtil3D.js";import{TargetType as a,TextureType as h,PixelFormat as f,PixelType as m,TextureWrapMode as n,TextureSamplingMode as u}from"../../webgl/enums.js";import{FramebufferObject as l}from"../../webgl/FramebufferObject.js";const c=e("esri-mobile")?64:128,_=c/128,g=Math.ceil(Math.sqrt(c)),p=(c+2)*g;class w{constructor(e,t){this._frameBuffer=new l(e,{colorTarget:a.TEXTURE,width:p,height:p},{target:h.TEXTURE_2D,pixelFormat:f.RGBA,dataType:m.UNSIGNED_BYTE,wrapMode:n.CLAMP_TO_EDGE,samplingMode:u.LINEAR,hasMipmap:!1,width:p,height:p}),this._vao=o(e),this._technique=new s({rctx:e,viewingMode:t.state.viewingMode})}get textureAtlas(){return this._frameBuffer.colorTexture}destroy(){this._technique=t(this._technique),this._frameBuffer=i(this._frameBuffer),this._vao=i(this._vao)}render(e){if(r(this._vao)||r(this.textureAtlas))return;const t=e.getViewport();e.setViewport(0,0,p,p),e.bindFramebuffer(this._frameBuffer);const i=e.useTechnique(this._technique);i.setUniform1f("tileSize",c),i.setUniform1f("tileRows",g),e.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.gl.drawArrays(e.gl.TRIANGLE_STRIP,0,4),e.setViewport(t.x,t.y,t.width,t.height)}}export{p as ATLAS_SIZE,w as NoiseTextureAtlas,_ as TEXTURE_SCALE,g as TILE_ROWS,c as TILE_SIZE};
