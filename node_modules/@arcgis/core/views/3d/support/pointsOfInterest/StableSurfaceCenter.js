/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import t from"../../../../core/Accessor.js";import r from"../../../../core/Handles.js";import{isNone as o}from"../../../../core/maybe.js";import{isAbortError as s}from"../../../../core/promiseUtils.js";import{on as i}from"../../../../core/watchUtils.js";import{property as a}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/arrayUtils.js";import"../../../../core/has.js";import"../../../../core/accessorSupport/ensureType.js";import{subclass as n}from"../../../../core/accessorSupport/decorators/subclass.js";import{c as l}from"../../../../chunks/vec3f64.js";import c from"../../../../geometry/Point.js";import{center as p}from"../../../../geometry/support/aaBoundingRect.js";let u=class extends t{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new r}get renderLocation(){if(!this.location)return null;const e=l();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],(()=>this._update())),i(this,"surface.layers","change",(()=>this._update()))]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||o(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=p(this.surfaceView.extent),t=new c({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then((e=>{this._updateController=null,this._set("location",e.geometry)})).catch((e=>{s(e)||e&&"elevation-query:invalid-layer"===e.name||console.error("StableSurfaceCenter failed to update: ",e)}))):this._set("location",t)}};e([a({constructOnly:!0})],u.prototype,"view",void 0),e([a({constructOnly:!0})],u.prototype,"cache",void 0),e([a({readOnly:!0,aliasOf:"view.map.ground"})],u.prototype,"surface",void 0),e([a({readOnly:!0,aliasOf:"view.basemapTerrain"})],u.prototype,"surfaceView",void 0),e([a({readOnly:!0})],u.prototype,"location",void 0),e([a({readOnly:!0})],u.prototype,"renderLocation",null),u=e([n("esri.views.3d.terrain.StableSurfaceCenter")],u);export{u as StableSurfaceCenter};
