/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{lerp as t,clamp as e}from"../../../core/mathUtils.js";import{d as i,i as n,r as o,o as a,g as r}from"../../../chunks/mat4.js";import{c as l}from"../../../chunks/mat4f64.js";import{s as c,e as s,n as u,m}from"../../../chunks/vec3.js";import{f as d,c as g,a as h}from"../../../chunks/vec3f64.js";import{ViewingMode as b}from"../../ViewingMode.js";import{S as f}from"../../../chunks/SunCalc.js";const y={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function p(i,n,o,a,r,l,u){c(u.ambient.color,1,1,1),u.ambient.intensity=y.global.ambient,c(u.direct.color,1,1,1),u.direct.intensity=y.global.direct;const m=n[2],g=e((Math.abs(m)-y.local.altitude)/(y.global.altitude-y.local.altitude),0,1);let h;if(u.globalFactor=g,"sun"===l&&(h=f.getTimes(i,n[1],n[0])),g<1){let e;if("sun"===l)e=D(i,h,a);else{const t=x(a);e={direct:{intensity:y.local.directAtNoon*t.direct,color:d(1,1,1)},ambient:{intensity:y.local.ambientAtNoon*t.ambient,color:d(1,1,1)},timeOfDay:"early afternoon"}}s(u.ambient.color,e.ambient.color,u.ambient.color,g),u.ambient.intensity=t(e.ambient.intensity,u.ambient.intensity,g),s(u.direct.color,e.direct.color,u.direct.color,g),u.direct.intensity=t(e.direct.intensity,u.direct.intensity,g),u.specularStrength="rainy"===a||"snowy"===a||"foggy"===a?0:1,u.environmentStrength="rainy"===a?.7:"snowy"===a||"foggy"===a?.75:1}u.noonFactor="sun"===l?P(i,h):1,"sun"===l?N(i,n,o,u.direct.directionToLightSource):A(r,o,u.direct.directionToLightSource)}function A(t,e,n){e===b.Global?u(G,t.eye):c(G,0,0,1),i(j,H,t.viewRight),m(n,G,j),i(j,k,G),m(n,n,j)}function N(t,i,l,s){const u=O,d=n(S);if(l===b.Global)f.getPosition(t,0,0,u),c(s,0,0,-1),o(d,d,-u.azimuth),a(d,d,-u.altitude),m(s,s,d);else{const n=y.planarDirection,a=n.globalAngles,l=i[2];let g=(Math.abs(l)-n.localAltitude)/(n.globalAltitude-n.localAltitude);g=e(g,0,1),g<1?(f.getPosition(t,i[1],i[0],u),u.azimuth=(1-g)*u.azimuth+g*a.azimuth,u.altitude=(1-g)*u.altitude+g*a.altitude):(u.azimuth=a.azimuth,u.altitude=a.altitude),c(s,0,-1,0),r(d,d,-u.azimuth),o(d,d,-u.altitude),m(s,s,d)}}function T(t,e){if(e===b.Global)return!0;const i=y.planarDirection;return Math.abs(t)<i.localAltitude}function w(t,e,i,n,o){const a=t.getTime(),r=e.getTime()-a,l=Math.floor(r/i)+1,c=new Array(l);for(let s=0;s<l;++s)I.setTime(a+i*s),c[s]=g(),N(I,n,o,c[s]);return c}const M=d(.5773502691896258,-.5773502691896258,.5773502691896258);class v{constructor(){this.ambient={color:d(1,1,1),intensity:.55},this.direct={color:d(1,1,1),intensity:.55,directionToLightSource:h(M)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const S=l(),O={azimuth:0,altitude:0};function P(t,i){const n=t.valueOf();let o,a;i.polarException===f.PolarException.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):i.polarException===f.PolarException.POLAR_NIGHT?(o=n-2,a=n-1):(o=i.sunrise.valueOf(),a=i.sunset.valueOf());const r=o+(a-o)/2;return 1-e(Math.abs(n-r)/432e5,0,1)}function x(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function z(t,e){const i=(t[0]+t[1]+t[2])/3;for(let n=0;n<3;n++)t[n]=t[n]+(i-t[n])*e;return t}function D(t,e,i){const n=t.valueOf();let o,a;e.polarException===f.PolarException.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):e.polarException===f.PolarException.POLAR_NIGHT?(o=n-2,a=n-1):(o=e.sunrise.valueOf(),a=e.sunset.valueOf());const r=a-o,l=o+r/2,c=r/4,s=l-c,u=l+c,m=.06*r,g=o-m/2,h=o+m/2,b=a-m/2,p=a+m/2,A=y.local,N=[.01,A.ambientAtNight],T=[.8,.8,1],w=[.01,.01,.01],M=[A.directAtTwilight,A.ambientAtTwilight],v=[1,.6,.5],S=[.8,.8,1],O=[.9*A.directAtNoon,A.ambientAtNoon],P=[1,.98,.98],D=[.98,.98,1],I=[A.directAtNoon,A.ambientAtNoon],j=[1,1,1],G=[1,1,1],H=O,k=P,L=D,F=M,_=v,R=S;let U,C,V=[0,0],q=[0,0,0],B=[0,0,0];n<g||n>p?(V=N,q=w,B=T,C="night"):n<h?(U=h-g,V=E(n-g,U,N,M),q=E(n-g,U,w,v),B=E(n-g,U,T,S),C="sun rising"):n<s?(U=s-h,V=E(n-h,U,M,O),q=E(n-h,U,v,P),B=E(n-h,U,S,D),C="early morning"):n<l?(U=l-s,V=E(n-s,U,O,I),q=E(n-s,U,P,j),B=E(n-s,U,D,G),C="late morning"):n<u?(U=u-l,V=E(n-l,U,I,H),q=E(n-l,U,j,k),B=E(n-l,U,G,L),C="early afternoon"):n<b?(U=b-u,V=E(n-u,U,H,F),q=E(n-u,U,k,_),B=E(n-u,U,L,R),C="late afternoon"):n<p&&(U=p-b,V=E(n-b,U,F,N),q=E(n-b,U,_,w),B=E(n-b,U,R,T),C="sun setting");let J=0;switch(i){case"rainy":case"foggy":J=.9;case"snowy":J=.5}J>0&&(q=z(q,J),B=z(B,J));const K=d(q[0],q[1],q[2]),Q=d(B[0],B[1],B[2]),W=x(i);return{direct:{intensity:V[0]*W.direct,color:K},ambient:{intensity:V[1]*W.ambient,color:Q},timeOfDay:C}}function E(t,e,i,n){const o=[];for(let a=0;a<i.length;a++)o[a]=(n[a]-i[a])*t/e+i[a];return o}const I=new Date(0),j=l(),G=g(),H=.35,k=-.5;export{v as ColorAndIntensity,p as computeColorAndIntensity,w as computeDirectionsOverTime,T as computeShadowsEnabled};
