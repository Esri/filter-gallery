/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../../chunks/tslib.es6.js";import{HandleOwner as e}from"../../../../../core/HandleOwner.js";import{deg2rad as i,rad2deg as s}from"../../../../../core/mathUtils.js";import{isSome as o,none as r,isNone as a,unwrapOr as l}from"../../../../../core/maybe.js";import{watch as h,sync as c}from"../../../../../core/reactiveUtils.js";import{property as n}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/arrayUtils.js";import"../../../../../core/has.js";import"../../../../../core/accessorSupport/ensureType.js";import{subclass as p}from"../../../../../core/accessorSupport/decorators/subclass.js";let y=class extends e{constructor(t){super(t),this.angle=0,this.scale=1,this.symbol=null,this.initialAngle=0}initialize(){this.restart()}restart(){this.handles.remove(m);const t=o(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:r;if(this.symbol=o(t)?t.clone():null,this.initialSizes=[],o(t)){const e=this.findLayerView();o(e)&&(this.initialSizes=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray())}this.angle=0,o(t)&&t.symbolLayers.some((t=>!("object"!==t.type||!o(t.heading))&&(this.angle=-i(t.heading),!0))),this.initialAngle=this.angle,this.scale=1,this.handles.add(h((()=>({angle:this.angle,scale:this.scale})),(t=>this._updateSymbol(t)),c),m)}cancel(){this.graphic.symbol=this.symbol}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t,this.restart()},redo:i=>{t=i.symbol,i.symbol=e,this.restart()}}}_updateSymbol({scale:t,angle:e}){const i=this.graphic.symbol;if(a(this.symbol)||a(i)||"point-3d"!==i.type)return;const r=i.clone(),h=-s(e-this.initialAngle);let c=!1;this._forEachObjectSymbolLayerPair(this.symbol,r,((e,i,s)=>{const r=l(e.heading,0)+h;i.heading!==r&&(i.heading=r,c=!0);const a=this.initialSizes[s];if(o(a)&&"width"in a){a.width=this.sizeFilter(a.width),a.height=this.sizeFilter(a.height),a.depth=this.sizeFilter(a.depth);const e=a.width*t;i.width!==e&&(i.width=e,c=!0);const s=a.depth*t;i.depth!==s&&(i.depth=s,c=!0);const o=a.height*t;i.height!==o&&(i.height=o,c=!0)}})),c&&(this.graphic.symbol=r)}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,s)=>{const o=e.symbolLayers.getItemAt(s);"object"===t.type&&"object"===o.type&&i(t,o,s)}))}};t([n()],y.prototype,"angle",void 0),t([n()],y.prototype,"scale",void 0),t([n({constructOnly:!0})],y.prototype,"graphic",void 0),t([n()],y.prototype,"symbol",void 0),t([n({constructOnly:!0})],y.prototype,"findLayerView",void 0),t([n({constructOnly:!0})],y.prototype,"sizeFilter",void 0),y=t([p("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],y);const m="scale-heading-update-key";export{y as ScaleRotateObjectSymbol3DAdapter};
