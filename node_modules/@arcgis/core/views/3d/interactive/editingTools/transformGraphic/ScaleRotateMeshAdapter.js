/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../chunks/tslib.es6.js";import{HandleOwner as t}from"../../../../../core/HandleOwner.js";import{deg2rad as s,rad2deg as r}from"../../../../../core/mathUtils.js";import{isSome as i}from"../../../../../core/maybe.js";import{watch as o,sync as a}from"../../../../../core/reactiveUtils.js";import{property as n}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/arrayUtils.js";import"../../../../../core/has.js";import"../../../../../core/accessorSupport/ensureType.js";import{subclass as c}from"../../../../../core/accessorSupport/decorators/subclass.js";import{axis as h,angle as p}from"../../../../../geometry/support/axisAngleDegrees.js";import{ViewingMode as l}from"../../../../ViewingMode.js";import{createGraphicGeometryUndoRecord as g}from"./undoRecords.js";let m=class extends t{constructor(e){super(e),this.angle=0,this.scale=1,this.initialAngle=0,this.previousAngle=0,this.previousScale=1}initialize(){this.restart()}restart(){this.handles.remove(d);const e=this.geometry.transform;if(this.scale=1,i(e)){const t=h(e.rotation)[2];Math.abs(t)>.999999&&(this.angle=s(p(e.rotation))*Math.sign(t))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(o((()=>({angle:this.angle,scale:this.scale})),(e=>this._update(e)),a),d)}cancel(){this.scale=1,this.angle=this.initialAngle}createUndoRecord(){return g(this.graphic)}_update({scale:e,angle:t}){const s=this.geometry.anchor,o=this.viewingMode===l.Global;e!==this.previousScale&&(this.geometry.scale(e/this.previousScale,{origin:s,geographic:o}),this.previousScale=e,i(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()),t!==this.previousAngle&&(this.geometry.rotate(0,0,r(t-this.previousAngle),{origin:s,geographic:o}),this.previousAngle=t,i(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged())}};e([n({constructOnly:!0})],m.prototype,"graphic",void 0),e([n({constructOnly:!0})],m.prototype,"geometry",void 0),e([n({constructOnly:!0})],m.prototype,"viewingMode",void 0),e([n()],m.prototype,"angle",void 0),e([n()],m.prototype,"scale",void 0),m=e([c("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],m);const d="scale-heading-update-key";export{m as ScaleRotateMeshAdapter};
