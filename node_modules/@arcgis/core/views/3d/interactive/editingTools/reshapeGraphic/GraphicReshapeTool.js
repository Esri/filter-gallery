/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../chunks/tslib.es6.js";import t from"../../../../../core/Evented.js";import r from"../../../../../core/Handles.js";import{destroyMaybe as o,isSome as i,isNone as a}from"../../../../../core/maybe.js";import{init as n}from"../../../../../core/watchUtils.js";import{property as s}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/arrayUtils.js";import"../../../../../core/has.js";import"../../../../../core/accessorSupport/ensureType.js";import{subclass as p}from"../../../../../core/accessorSupport/decorators/subclass.js";import{SupportedGraphicResult as h}from"../isSupportedGraphicUtils.js";import{geometryOfSupportedGraphic as l,isSupportedGraphic as c}from"./isSupportedGraphic.js";import{ReshapeOperation as d}from"./ReshapeOperation.js";import{InteractiveToolBase as m}from"../../../../interactive/InteractiveToolBase.js";let u=class extends(t.EventedMixin(m)){constructor(e){super(e),this._handles=new r,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.snappingManager=null,this.automaticManipulatorSelection=!1}destroy(){this._handles=o(this._handles),this._reshapeOperation=o(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get updating(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}_updateGeometry(){const e=l(this.graphic);this._reshapeOperation.inputGeometry=i(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),c(this.graphic)!==h.SUPPORTED)return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){a(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}initialize(){this._reshapeOperation=new d({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>{e.stopPropagation()})),n(this,"graphic",(()=>{this._updateGraphic()}),!0)]),this.finishToolCreation()}get canUndo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}undo(){i(this.snappingManager)&&this.snappingManager.doneSnapping(),i(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}redo(){i(this.snappingManager)&&this.snappingManager.doneSnapping(),i(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};e([s()],u.prototype,"_reshapeOperation",void 0),e([s({constructOnly:!0,nonNullable:!0})],u.prototype,"view",void 0),e([s({constructOnly:!0})],u.prototype,"graphic",void 0),e([s({constructOnly:!0,nonNullable:!0})],u.prototype,"enableZShape",void 0),e([s({constructOnly:!0,nonNullable:!0})],u.prototype,"enableZVertex",void 0),e([s({constructOnly:!0,nonNullable:!0})],u.prototype,"enableMoveGraphic",void 0),e([s({constructOnly:!0,nonNullable:!0})],u.prototype,"enableMidpoints",void 0),e([s({constructOnly:!0,nonNullable:!0})],u.prototype,"enableEdgeOffset",void 0),e([s({readOnly:!0})],u.prototype,"type",void 0),e([s({constructOnly:!0})],u.prototype,"snappingManager",void 0),e([s({readOnly:!0})],u.prototype,"updating",null),e([s()],u.prototype,"automaticManipulatorSelection",void 0),u=e([p("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],u);export{u as GraphicReshapeTool};
