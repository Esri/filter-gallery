/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import t from"../../../../../core/Handles.js";import{isSome as i}from"../../../../../core/maybe.js";import{screenToMapXYForGraphic as e}from"../dragEventPipeline3D.js";import{ManipulatorType as r}from"../ManipulatorType.js";import{Manipulation as a}from"./Manipulation.js";import{createGraphicMoveDragPipeline as o}from"./moveUtils.js";import{createManipulatorDragEventPipeline as s,addMapDelta as n,addScreenDelta as l}from"../../../../interactive/dragEventPipeline.js";import{GraphicManipulator as p}from"../../../../interactive/GraphicManipulator.js";class h extends a{constructor(i){super(),this._handles=new t,this._view=i.view,this._tool=i.tool,this._graphicState=i.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,r.TRANSLATE_XY)}createGraphicDragPipeline(t){return o(this._graphicState,t,(t=>this.createDragPipeline(t)),this._view.state.viewingMode)}createDragPipeline(t){const r=this._view,a=this._graphicState.graphic,o=i(a.geometry)?a.geometry.spatialReference:null;return s(this._manipulator,((i,s,p,h,c)=>{const m=s.next(e(c,r,a,o)).next(n()).next(l());t(i,m,p,h,c)}))}_createManipulator(){const t=this._view,i=this._graphicState.graphic;this._manipulator=new p({graphic:i,view:t,selectable:!0,cursor:"move"})}}export{h as MoveXYGraphicManipulation};
