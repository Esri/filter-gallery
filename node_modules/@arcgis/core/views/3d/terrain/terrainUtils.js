/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import e from"../../../core/Collection.js";import{unwrapOr as t,isSome as n}from"../../../core/maybe.js";import{isCGCS2000 as l,isEarth as o}from"../../../geometry/support/spatialReferenceUtils.js";import{isWMTSLayer as i,getTileMaxtrixSetFromActiveLayer as r}from"../../../layers/support/layerUtils.js";import{ViewingMode as u}from"../../ViewingMode.js";import{ImageWithType as a}from"../support/StreamDataLoader.js";import{t as f}from"../../../chunks/terrainUtilsPlanar.js";import{t as c}from"../../../chunks/terrainUtilsSpherical.js";const s={[u.Global]:c,[u.Local]:f};function p(e,t){e||console.warn("Terrain: "+t)}const m=1.2,d=80/180*Math.PI,v=110/180*Math.PI;function y(e,l,o){const i=s[e.viewingMode];let r;if(i.isInsideExtent(e,l))r=t(e.getElevation(l[0],l[1],l[1],e.spatialReference),0);else{if(!i.isInsideExtent(e,l,m))return 0;const t=e.getTileWithElevation(l[0],l[1],l[1],e.spatialReference);r=.5*((n(t)?t.elevationBounds[0]:e.elevationBounds.min)+(n(t)?t.elevationBounds[1]:e.elevationBounds.max));const o=i.tiltToExtentEdge(e,l,r);if(o>d&&o<v)return 0}const u=l[2]-r;return Math.abs(u)<o?0:u<0?-1:1}function I(e){return g(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function x(e){return"vector-tile"===(null==e?void 0:e.type)}function E(e){return"imagery-tile"===(null==e?void 0:e.type)||"wcs"===(null==e?void 0:e.type)}function g(e){return"imagery-tile-3d"===(null==e?void 0:e.type)}function h(e){return"tile-3d"===(null==e?void 0:e.type)}function L(e){return"vector-tile-3d"===(null==e?void 0:e.type)}function T(e){return"wmts-3d"===(null==e?void 0:e.type)}function S(e){return"elevation-3d"===(null==e?void 0:e.type)}function j(e){return e&&(h(e)||g(e)||S(e)||L(e)||T(e))}function C(e){var t;const l=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return n(l)&&"type"in l&&"raster-tile"===l.type}function M(e){var t;const l=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return n(l)&&"type"in l&&"vector-tile"===l.type}function b(e){var t;const l=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return n(l)&&"type"in l&&"tile-texture"===l.type}function w(e){var t;const n=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return n instanceof HTMLImageElement||n instanceof a||n instanceof HTMLCanvasElement||n instanceof ImageData}function R(e){return n(e)&&"release"in e&&e.release(),null}function B(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function U(e,t,n,l){return s[l].checkIfTileInfoSupportedForViewSR(e,n,t)}function V(e,t,l){let o=null,r=null;if(i(e)){const n=k(e,t,l);o=n.tileInfo,r=n.fullExtent}else{r=E(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=l===u.Local;if(E(e))o=e.getCompatibleTileInfo(t,r,n);else if(x(e)){const l=n&&!F(t)||G.force512VTL,i=e.tileInfo.spatialReference.isGeographic;o=l?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,i?1:2)}else o=e.tileInfo}return n(o)&&n(r)&&null==U(o,r,t,l)?{tileInfo:o,fullExtent:r}:null}function k(t,l,o){const i=r(t);if(n(i)){if(!e.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const e=i.find((e=>null==U(e.tileInfo,e.fullExtent,l,o)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function F(e){return e.isWGS84||e.isWebMercator||l(e)||!o(e)}const G={force512VTL:!1};export{U as checkIfTileInfoSupportedForView,y as computeSkirtScale,I as getLayerWithExtentRange,k as getTileInfoAndExtentFromWMTSLayer,V as getTiledLayerInfo,S as isElevationLayerView,g as isImageryTileLayerView,C as isImageryTileRenderInfo,E as isProjectableRasterLayer,w as isRasterTileRenderInfo,j as isSurfaceLayerView,b as isTextureTileRenderInfo,h as isTileLayerView,x as isVectorTileLayer,L as isVectorTileLayerView,M as isVectorTileRenderInfo,T as isWMTSLayerView,R as releaseTileData,G as test,B as useFetchTileForLayer,F as vtlAssumes256PixelSizeAsDefault,p as weakAssert};
