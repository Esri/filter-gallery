/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{init as t}from"../core/watchUtils.js";import{aliasOf as s}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/arrayUtils.js";import"../core/has.js";import{cast as i}from"../core/accessorSupport/decorators/cast.js";import{property as n}from"../core/accessorSupport/decorators/property.js";import{subclass as r}from"../core/accessorSupport/decorators/subclass.js";import o from"./Widget.js";import l from"./Feature/FeatureAttachments.js";import d from"./Feature/FeatureContent.js";import a from"./Feature/FeatureExpression.js";import c from"./Feature/FeatureFields.js";import u from"./Feature/FeatureMedia.js";import p from"./Feature/FeatureViewModel.js";import{FeatureContentMixin as m}from"./Feature/support/FeatureContentMixin.js";import{Heading as h}from"./support/Heading.js";import"./support/widgetUtils.js";import{messageBundle as v}from"./support/decorators/messageBundle.js";import"../core/Logger.js";import{tsx as g}from"./support/jsxFactory.js";import{substitute as f}from"../intl/substitute.js";const y={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},_={title:!0,content:!0,lastEditedInfo:!0};let w=class extends(m(o)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={..._},this.map=null,this.view=null,this.viewModel=new p}initialize(){this.own(t(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}loadDependencies(){return import("@esri/calcite-components/dist/components/calcite-notice.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{..._,...e}}render(){const{state:e}=this.viewModel,t=g("div",{class:y.container,key:"container"},this.renderTitle(),"error"===e?this.renderError():"loading"===e?this.renderLoading():this.renderContentContainer());return g("div",{class:this.classes(y.base,y.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:s}=this;return g("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},s.title?g("div",{key:"error-title",slot:"title"},e.errorMessage):null,g("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return g("div",{key:"loading-container",class:y.loadingSpinnerContainer},g("span",{class:this.classes(y.iconLoading,y.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?g("div",{class:y.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?g(h,{level:this.headingLevel,class:y.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?g("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:g("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:s}=this;if("boolean"!=typeof s.content&&!s.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:s,attachmentInfos:i}=t.viewModel;return"loading"===s||i.length>0?g("div",{key:this._buildKey("attachments-element",e),class:this.classes(y.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:g("div",{key:this._buildKey("expression-element",e),class:y.contentElement},t.render())}renderCustom(e,t){const{creator:s}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:s?g("div",{key:this._buildKey("custom-element",t),class:y.contentElement},i.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:g("div",{key:this._buildKey("fields-element",e),class:y.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:g("div",{key:this._buildKey("media-element",e),class:y.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:s}=this.viewModel;if(!s||!e.lastEditedInfo)return null;const{date:i,user:n}=s,r="edit"===s.type?n?t.lastEditedByUser:t.lastEdited:n?t.lastCreatedByUser:t.lastCreated,o=f(r,{date:i,user:n});return g("div",{key:"edit-info-element",class:this.classes(y.lastEditedInfo,y.contentElement)},o)}renderText(e,t){const s=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:s?g("div",{key:this._buildKey("text-element",t),class:this.classes(y.contentElement,y.text)},i.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach((e=>this._destroyContentWidget(e))),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,s=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(s))s.forEach(((s,n)=>{"attachments"===s.type&&(this._contentWidgets[n]=new l({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:i[n]})),"fields"===s.type&&(this._contentWidgets[n]=new c({viewModel:i[n]})),"media"===s.type&&(this._contentWidgets[n]=new u({viewModel:i[n]})),"text"===s.type&&(this._contentWidgets[n]=new d({viewModel:i[n]})),"custom"===s.type&&(this._contentWidgets[n]=new d({viewModel:i[n]})),"expression"===s.type&&(this._contentWidgets[n]=new a({viewModel:i[n]}))}),this);else{const e=i[0];e&&!e.destroyed&&(this._contentWidgets[0]=new d({viewModel:e}))}this.scheduleRender()}};e([s("viewModel.graphic")],w.prototype,"graphic",void 0),e([s("viewModel.defaultPopupTemplateEnabled")],w.prototype,"defaultPopupTemplateEnabled",void 0),e([n()],w.prototype,"headingLevel",void 0),e([n({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],w.prototype,"label",void 0),e([n(),v("esri/widgets/Feature/t9n/Feature")],w.prototype,"messages",void 0),e([n(),v("esri/t9n/common")],w.prototype,"messagesCommon",void 0),e([n(),v("esri/widgets/support/t9n/uriUtils")],w.prototype,"messagesURIUtils",void 0),e([s("viewModel.spatialReference")],w.prototype,"spatialReference",void 0),e([s("viewModel.title")],w.prototype,"title",void 0),e([n()],w.prototype,"visibleElements",void 0),e([i("visibleElements")],w.prototype,"castVisibleElements",null),e([s("viewModel.map")],w.prototype,"map",void 0),e([s("viewModel.view")],w.prototype,"view",void 0),e([n({type:p})],w.prototype,"viewModel",void 0),w=e([r("esri.widgets.Feature")],w);const M=w;export{M as default};
