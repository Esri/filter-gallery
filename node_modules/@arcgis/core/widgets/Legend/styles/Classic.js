/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../intl.js";import{property as r}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import{subclass as l}from"../../../core/accessorSupport/decorators/subclass.js";import a from"../../Widget.js";import{renderRelationshipRamp as s}from"./support/relationshipUtils.js";import{getUnivariateAboveAndBelowRampElements as t,getUnivariateColorRampSize as i,getUnivariateColorRampPreview as n,getUnivariateColorRampMargin as o,getUnivariateColorSizeRampElements as p}from"./support/univariateUtils.js";import{getTitle as d,isRendererTitle as y,attachToNode as c,isImageryStretchedLegend as m}from"../support/styleUtils.js";import{Heading as g}from"../../support/Heading.js";import"../../support/widgetUtils.js";import{messageBundle as v}from"../../support/decorators/messageBundle.js";import"../../../core/Logger.js";import{tsx as h}from"../../support/jsxFactory.js";import{formatNumber as b}from"../../../intl/number.js";const u={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},_="esri-legend__",f=24,L={display:"flex",alignItems:"flex-start"},w={marginLeft:"3px"},C={display:"table-cell",verticalAlign:"middle"};let R=class extends a{constructor(e,r){super(e,r),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,r=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return h("div",null,r&&r.length?r:h("div",{class:u.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const r=!!e.children.length,l=`${_}${e.layer.uid}-version-${e.version}`,a=e.title?g({level:this.headingLevel,class:this.classes(u.header,u.label)},e.title):null;if(r){const r=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return h("div",{key:l,class:this.classes(u.service,u.groupLayer)},a,r)}{const r=e.legendElements;if(r&&!r.length)return null;const s=r.map((r=>this._renderLegendForElement(r,e.layer,e.effectList))).filter((e=>!!e));if(!s.length)return null;const t={[u.groupLayerChild]:!!e.parent};return h("div",{key:l,class:this.classes(u.service,t),tabIndex:0},a,h("div",{class:u.layer},s))}}_renderLegendForElement(e,r,l,a){const t="color-ramp"===e.type,i="opacity-ramp"===e.type,n="size-ramp"===e.type;let o=null;if("symbol-table"===e.type||n){const a=e.infos.map((a=>this._renderLegendForElementInfo(a,r,l,n,e.legendType))).filter((e=>!!e));a.length&&(o=h("div",{class:u.layerBody},a))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o=this._renderLegendForRamp(e,r.opacity):"relationship-ramp"===e.type?o=s(e,this.id,r.opacity,l):"univariate-above-and-below-ramp"===e.type?o=this._renderUnivariateAboveAndBelowRamp(e,r.opacity,l):"univariate-color-size-ramp"===e.type&&(o=this._renderUnivariateColorSizeRamp(e,r.opacity,l));if(!o)return null;const p=e.title;let c=null;if("string"==typeof p)c=p;else if(p){const e=d(this.messages,p,t||i);c=y(p,t||i)&&p.title?`${p.title} (${e})`:e}const m=a?u.layerChildTable:u.layerTable,g=c?h("div",{class:u.layerCaption},c):null,v={[u.layerTableSizeRamp]:n||!a};return h("div",{class:this.classes(m,v)},g,o)}_renderUnivariateAboveAndBelowRamp(e,r,l){const{sizeRampElement:a,colorRampElement:s}=t(e,r);if(!a)return null;const p=i(a,"above",!0),d=i(a,"below",!0),y=12,m=n(s,{width:y,height:p,rampAlignment:"vertical",opacity:r,type:"above",effectList:l}),g=n(s,{width:y,height:d,rampAlignment:"vertical",opacity:r,type:"below",effectList:l}),v=o(a),b=a.infos.map((e=>e.label)),_=b.map(((e,r)=>{const l=2===r;return 0===r?h("div",{key:r,class:e?m?u.univariateAboveAndBelowLabel:u.rampLabel:null},e):l?h("div",null):null})),f=b.length-1,R=Math.floor(b.length/2),A=b.map(((e,r)=>r===R||r===f?h("div",{key:r,class:e?m?u.univariateAboveAndBelowLabel:u.rampLabel:null},e):null)),S={display:"table-cell",verticalAlign:"middle"},j={marginTop:`${v}px`},I={height:`${p}px`},k={height:`${d}px`};return h("div",{key:"univariate-above-and-below-ramp-preview",styles:L},h("div",{class:u.layerBody},a.infos.map(((e,r)=>h("div",{class:this.classes(u.layerRow,u.sizeRamp)},h("div",{class:u.symbol,styles:S,bind:e.preview,afterCreate:c}),m||r%2!=0?null:h("div",{class:u.layerInfo},b[r]))))),m?h("div",{styles:j,key:"color-ramp-preview"},h("div",{styles:w},h("div",{styles:C},h("div",{class:u.rampContainer,bind:m,afterCreate:c})),h("div",{styles:C},h("div",{class:u.rampLabelsContainer,styles:I},_))),h("div",{styles:w},h("div",{styles:C},h("div",{class:u.rampContainer,bind:g,afterCreate:c})),h("div",{styles:C},h("div",{class:u.rampLabelsContainer,styles:k},A)))):null)}_renderUnivariateColorSizeRamp(e,r,l){const{sizeRampElement:a,colorRampElement:s}=p(e);if(!a)return null;const t=o(a),d=12,y=i(a,"full",!1),m=n(s,{width:d,height:y,rampAlignment:"vertical",opacity:r,type:"full",effectList:l}),g=a.infos.length-1,v=a.infos.map(((e,r)=>0===r||r===g?h("div",{key:r,class:e.label?s?u.univariateAboveAndBelowLabel:u.rampLabel:null},e.label):null)),b={display:"table-cell",verticalAlign:"middle"},_={marginTop:`${t}px`},f={height:`${y}px`};return h("div",{key:"univariate-above-and-below-ramp-preview",styles:L},h("div",{class:u.layerBody},a.infos.map((e=>h("div",{class:this.classes(u.layerRow,u.sizeRamp)},h("div",{class:u.symbol,styles:b,bind:e.preview,afterCreate:c}))))),h("div",{styles:_,key:"color-ramp-preview"},h("div",{styles:w},h("div",{styles:C},h("div",{class:u.rampContainer,bind:m,afterCreate:c})),h("div",{styles:C},h("div",{class:u.rampLabelsContainer,styles:f},v)))))}_renderLegendForRamp(e,r){const l=e.infos,a="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,t="stretch-ramp"===e.type,i=e.preview,n=a?u.opacityRamp:"";i.className=`${u.colorRamp} ${n}`,null!=r&&(i.style.opacity=r.toString());const o=l.map((e=>h("div",{class:e.label?u.rampLabel:null},s?this.messages[e.label]:t?this._getStretchStopLabel(e):e.label))),p={width:`${f}px`},d={height:i.style.height};return h("div",{class:u.layerRow},h("div",{class:u.symbolContainer,styles:p},h("div",{class:u.rampContainer,bind:i,afterCreate:c})),h("div",{class:u.layerInfo},h("div",{class:u.rampLabelsContainer,styles:d},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:b(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""}_renderLegendForElementInfo(e,r,l,a,s){if(e.type)return this._renderLegendForElement(e,r,l,!0);let t=null;const i=m(r,s);if(e.preview?t=h("div",{class:u.symbol,bind:e.preview,afterCreate:c}):e.src&&(t=this._renderImage(e,r,i)),!t)return null;const n={[u.imageryLayerInfoStretched]:i},o={[u.imageryLayerInfoStretched]:i,[u.sizeRamp]:!i&&a};return h("div",{class:u.layerRow},h("div",{class:this.classes(u.symbolContainer,o)},t),h("div",{class:this.classes(u.layerInfo,n)},d(this.messages,e.label,!1)||""))}_renderImage(e,r,l){const{label:a,src:s,opacity:t}=e,i={[u.imageryLayerStretchedImage]:l,[u.symbol]:!l},n={opacity:`${null!=t?t:r.opacity}`};return h("img",{alt:d(this.messages,a,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(i),styles:n})}};e([r()],R.prototype,"activeLayerInfos",void 0),e([r()],R.prototype,"headingLevel",void 0),e([r(),v("esri/widgets/Legend/t9n/Legend")],R.prototype,"messages",void 0),e([r({readOnly:!0})],R.prototype,"type",void 0),R=e([l("esri.widgets.Legend.styles.Classic")],R);const A=R;export{A as default};
