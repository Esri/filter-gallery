/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import i from"../../core/Error.js";import{isSome as r}from"../../core/maybe.js";import{aliasOf as l}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/arrayUtils.js";import"../../core/has.js";import"../../core/accessorSupport/ensureType.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import{subclass as t}from"../../core/accessorSupport/decorators/subclass.js";import a from"../../renderers/visualVariables/support/ColorSizeStop.js";import o from"../../renderers/visualVariables/support/ColorStop.js";import n from"../../renderers/visualVariables/support/SizeStop.js";import{SmartMappingSliderBase as d}from"./SmartMappingSliderBase.js";import p from"./ColorSizeSlider/ColorSizeSliderViewModel.js";import{getDynamicPathForSizeStops as u,getPathForSizeStops as m}from"./support/utils.js";import{storeNode as c}from"../support/widgetUtils.js";import{messageBundle as h}from"../support/decorators/messageBundle.js";import"../../core/Logger.js";import{tsx as v}from"../support/jsxFactory.js";var b;const g={base:"esri-color-size-slider",rampElement:"esri-color-size-slider__ramp",sliderContainer:"esri-color-size-slider__slider-container",histogramContainer:"esri-color-size-slider__histogram-container",primaryHandle:"esri-color-size-slider--primary-handle",track:"esri-color-size-slider--interactive-track",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"};let f=b=class extends d{constructor(e,i){super(e,i),this._bgFillId=null,this._backgroundFillColor="#e0e0e0",this._minRampFillWidth=.2,this._rampFillId=null,this._rampNode=null,this._maxRampFillWidth=1,this.handlesSyncedToPrimary=null,this.label=void 0,this.messages=null,this.persistSizeRangeEnabled=null,this.primaryHandleEnabled=null,this.stops=null,this.viewModel=new p,this.zoomOptions=null,this._bgFillId=`${this.id}-bg-fill`,this._rampFillId=`${this.id}-linear-gradient`}static fromRendererResult(e,r){const{renderer:{authoringInfo:{univariateTheme:l}},color:{visualVariable:{stops:s}},size:{visualVariables:t},statistics:o}=e,{avg:n,stddev:d}=o;if(!s)throw new i("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const p="above-and-below"===l,u=e.renderer.authoringInfo.visualVariables[0],m=u.minSliderValue,c=u.maxSliderValue,h=t.find((e=>"outline"!==(null==e?void 0:e.target)&&!(null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))&&((null==e?void 0:e.field)||(null==e?void 0:e.valueExpression)))),v=h.stops,g=s.map(((e,i)=>{const{color:r,label:l,value:t}=e;let o;return o=v&&v.length>0?v[i].size:0===i?h.minSize:i===s.length-1?h.maxSize:null,new a({color:r,label:l,value:t,size:o})}));return new b({max:c,min:m,stops:g,primaryHandleEnabled:p,handlesSyncedToPrimary:p,persistSizeRangeEnabled:p,histogramConfig:{average:n,standardDeviation:d,bins:r?r.bins:[]}})}updateFromRendererResult(e,r){const{renderer:{authoringInfo:{univariateTheme:l}},color:{visualVariable:{stops:s}},size:{visualVariables:t},statistics:o}=e,{avg:n,stddev:d}=o;if(!s)throw new i("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const p="above-and-below"===l,u=e.renderer.authoringInfo.visualVariables[0],m=u.minSliderValue,c=u.maxSliderValue,h=t.find((e=>"outline"!==(null==e?void 0:e.target)&&!(null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))&&((null==e?void 0:e.field)||(null==e?void 0:e.valueExpression)))),v=h.stops,b=s.map(((e,i)=>{const{color:r,label:l,value:t}=e;let o;return o=v&&v.length>0?v[i].size:0===i?h.minSize:i===s.length-1?h.maxSize:null,new a({color:r,label:l,value:t,size:o})}));this.set({max:c,min:m,stops:b,primaryHandleEnabled:p,handlesSyncedToPrimary:p,persistSizeRangeEnabled:p,histogramConfig:{average:n,standardDeviation:d,bins:r?r.bins:[]}})}updateRenderer(e){const{stops:i}=this,l=i[0],s=i[i.length-1],t=i[Math.floor(i.length/2)],a=e.clone(),d=a.visualVariables.map((e=>{if("size"===e.type){if("outline"===(null==e?void 0:e.target)||null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))return e;r(e.minSize)&&r(e.maxSize)?e.set({maxDataValue:s.value,minDataValue:l.value,maxSize:s.size,minSize:l.size}):e.stops&&e.set({stops:i.map((e=>{const{label:i,size:r,value:l}=e;return new n({label:i,size:r,value:l})}))})}else"color"===e.type&&e.set({stops:this.stops.map((e=>{const{color:i,label:r,value:l}=e;return new o({color:i,label:r,value:l})}))});return e}));if(a.visualVariables=d,a.classBreakInfos.length>1){const e=t.value;a.classBreakInfos[0].maxValue=e,a.classBreakInfos[1].minValue=e}return a}updateVisualVariables(e){return e.map((e=>{const i=e.clone();if("size"===e.type){if("outline"===(null==e?void 0:e.target)||null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))return i;if(r(e.minSize)&&r(e.maxSize)){const{stops:e}=this,r=e[0],l=e[e.length-1];i.set({maxDataValue:l.value,minDataValue:r.value,maxSize:l.size,minSize:r.size})}else e.stops&&i.set({stops:this.stops.map((e=>{const{label:i,size:r,value:l}=e;return new n({label:i,size:r,value:l})}))})}else"color"===e.type&&i.set({stops:this.stops.map((e=>{const{color:i,label:r,value:l}=e;return new o({color:i,label:r,value:l})}))});return i}))}render(){const{label:e,primaryHandleEnabled:i,state:r,visibleElements:l}=this,s="disabled"===r,t=this.classes(g.base,g.esriWidget,g.esriWidgetPanel,{[g.disabled]:s,[g.primaryHandle]:i,[g.track]:l.interactiveTrack});return v("div",{"aria-label":e,class:t},s?null:this.renderContent(this.renderRamp(),g.sliderContainer,g.histogramContainer))}renderRamp(){const{_bgFillId:e,_rampFillId:i,viewModel:r,zoomOptions:l}=this,s=r.getStopInfo();return v("div",{afterCreate:c,bind:this,class:g.rampElement,"data-node-ref":"_rampNode"},v("svg",{xmlns:"http://www.w3.org/2000/svg"},v("defs",null,this.renderRampFillDefinition(i,s),this.renderBackgroundFillDefinition(e)),v("rect",{x:"0",y:"0",fill:this._backgroundFillColor,height:"100%",width:"100%"}),this.renderPaths()),l?this.renderZoomCaps():null)}renderPaths(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:i=0}=this._rampNode;if(!r(e)||!r(i))return;const{primaryHandleEnabled:l,stops:s,values:t,viewModel:{max:a,min:o},_bgFillId:n,_maxRampFillWidth:d,_minRampFillWidth:p,_rampFillId:c}=this,h=[d,p];s[0].size<s[s.length-1].size&&h.reverse();const b=t.slice().sort(((e,i)=>e>i?1:-1)),[g,f]=h,[z,S]=b,y=l?u({max:a,min:o,pathHeight:e,pathWidth:i,stops:s,padding:p}):m({bottomValue:z,bottomWidth:g,max:a,min:o,pathHeight:e,pathWidth:i,topValue:S,topWidth:f});return[v("path",{key:"background",d:y,fill:`url(#${n})`}),v("path",{key:"fill",d:y,fill:`url(#${c})`})]}};e([l("viewModel.handlesSyncedToPrimary")],f.prototype,"handlesSyncedToPrimary",void 0),e([s({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0),e([s(),h("esri/widgets/smartMapping/ColorSizeSlider/t9n/ColorSizeSlider")],f.prototype,"messages",void 0),e([l("viewModel.persistSizeRangeEnabled")],f.prototype,"persistSizeRangeEnabled",void 0),e([l("viewModel.primaryHandleEnabled")],f.prototype,"primaryHandleEnabled",void 0),e([l("viewModel.stops")],f.prototype,"stops",void 0),e([s()],f.prototype,"viewModel",void 0),e([l("viewModel.zoomOptions")],f.prototype,"zoomOptions",void 0),f=b=e([t("esri.widgets.smartMapping.ColorSizeSlider")],f);const z=f;export{z as default};
