/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import r from"../../Color.js";import{isSome as i}from"../../core/maybe.js";import{aliasOf as s}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/arrayUtils.js";import"../../core/has.js";import{cast as o}from"../../core/accessorSupport/decorators/cast.js";import{property as t}from"../../core/accessorSupport/decorators/property.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import l from"../../renderers/visualVariables/support/SizeStop.js";import{getCIMSymbolColor as n}from"../../symbols/support/cimSymbolUtils.js";import{SmartMappingSliderBase as d}from"./SmartMappingSliderBase.js";import p from"./BinaryColorSizeSlider/BinaryColorSizeSliderViewModel.js";import{getSizesFromVariable as m,getFillFromColor as c,getDynamicPathForSizeStops as u}from"./support/utils.js";import{storeNode as y}from"../support/widgetUtils.js";import{messageBundle as h}from"../support/decorators/messageBundle.js";import"../../core/Logger.js";import{tsx as b}from"../support/jsxFactory.js";var v;const g={base:"esri-binary-color-size-slider",rampElement:"esri-binary-color-size-slider__ramp",sliderContainer:"esri-binary-color-size-slider__slider-container",histogramContainer:"esri-binary-color-size-slider__histogram-container",zoomCapTop:"esri-binary-color-size-slider__zoom-cap-top",zoomCapBottom:"esri-binary-color-size-slider__zoom-cap-bottom",zoomCapLine:"esri-binary-color-size-slider__zoom-cap-line",zoomCapMask:"esri-binary-color-size-slider__zoom-cap-mask",zoomCapUnderline:"esri-binary-color-size-slider__zoom-cap-underline",primaryHandle:"esri-binary-color-size-slider--primary-handle",track:"esri-binary-color-size-slider--interactive-track",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},f={trackBackgroundColor:new r([224,224,224]),trackAboveFillColor:new r([149,149,149]),trackBelowFillColor:new r([149,149,149])};let z=v=class extends d{constructor(e,r){super(e,r),this._minRampFillWidth=.2,this._rampNode=null,this._rampFillId=null,this.handlesSyncedToPrimary=null,this.label=void 0,this.messages=null,this.persistSizeRangeEnabled=null,this.stops=null,this.style={...f},this.viewModel=new p,this.zoomOptions=null,this._rampFillId=`${this.id}-linear-gradient`}castStyle(e){return{...f,...e}}static fromRendererResult(e,r){const{size:{visualVariables:i},statistics:s}=e,{avg:o,stddev:t}=s,a=i[0].stops,l=e.renderer.authoringInfo.visualVariables[0],d=l.minSliderValue,p=l.maxSliderValue,m=e.renderer.classBreakInfos;let c,u,y=null;const h=e=>{if("cim"===e.type)return n(e);if(e.symbolLayers){var r,i;return null==(i=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:i.color}return e.color};if(m.length>1){const e=m[0].symbol,r=m[1].symbol;u=h(e),c=h(r)}return 1===m.length&&(y=h(m[0].symbol)),new v({max:p,min:d,stops:a,histogramConfig:{average:o,standardDeviation:t,bins:r?r.bins:[]},style:{trackAboveFillColor:c,trackBelowFillColor:u,trackFillColor:y},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})}updateFromRendererResult(e,r){const{size:{visualVariables:i},statistics:s}=e,{avg:o,stddev:t}=s,a=i[0].stops,l=e.renderer.authoringInfo.visualVariables[0],d=l.minSliderValue,p=l.maxSliderValue,m=e.renderer.classBreakInfos;let c,u,y=null;const h=e=>{if("cim"===e.type)return n(e);if(e.symbolLayers){var r,i;return null==(i=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:i.color}return e.color};if(m.length>1){const e=m[0].symbol,r=m[1].symbol;u=h(e),c=h(r)}1===m.length&&(y=h(m[0].symbol)),this.set({max:p,min:d,stops:a,histogramConfig:{average:o,standardDeviation:t,bins:r?r.bins:[]},style:{trackAboveFillColor:c,trackBelowFillColor:u,trackFillColor:y},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})}updateRenderer(e){var r,i;if("univariate-color-size"!==(null==(r=e.authoringInfo)?void 0:r.type)||"above-and-below"!==(null==(i=e.authoringInfo)?void 0:i.univariateTheme))return console.error("Input renderer must be a univariate renderer with an above-and-below theme."),null;const s=e.clone(),o=s.visualVariables.find((e=>"size"===e.type&&"outline"!==e.target&&e.stops)),{stops:t}=this;if(!o||!t)return console.error("No size stops available."),null;const a=s.visualVariables.indexOf(o);s.visualVariables.splice(a,1),o.stops=t,s.visualVariables.push(o);const l=t[5===t.length?2:1].value;return s.classBreakInfos[0].maxValue=l,s.classBreakInfos[1].minValue=l,s}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:r,minDataValue:i,stops:s}=e;if(s)this.stops=s;else{const[s,o]=m(e);this.stops=[new l({value:i,size:o}),new l({value:r,size:s})]}}render(){const{label:e,state:r,viewModel:{primaryHandleEnabled:i},visibleElements:s}=this,o="disabled"===r,t=this.classes(g.base,g.esriWidget,g.esriWidgetPanel,{[g.disabled]:o,[g.primaryHandle]:i,[g.track]:s.interactiveTrack});return b("div",{"aria-label":e,class:t},o?null:this.renderContent(this.renderRamp(),g.sliderContainer,g.histogramContainer))}renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:r}=this;return b("div",{afterCreate:y,bind:this,class:g.rampElement,"data-node-ref":"_rampNode"},b("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},b("rect",{x:"0",y:"0",fill:c(e),height:"100%",width:"100%"}),this.renderPrimaryRamp(),this.renderPath()),r?this.renderZoomCaps():null)}renderPrimaryRamp(){const{_rampFillId:e,style:{trackAboveFillColor:r,trackBelowFillColor:i},viewModel:s}=this;return[b("defs",null,this.renderRampFillDefinition(e,s.getGradientStopInfo(r,i)))]}renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(!i(e)||!i(r))return;const{stops:s,viewModel:{max:o,min:t},_rampFillId:a,_minRampFillWidth:l}=this,n=u({max:o,min:t,pathHeight:e,pathWidth:r,stops:s,padding:l});return b("path",{d:n,fill:`url(#${a})`})}};e([s("viewModel.handlesSyncedToPrimary")],z.prototype,"handlesSyncedToPrimary",void 0),e([t({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],z.prototype,"label",void 0),e([t(),h("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],z.prototype,"messages",void 0),e([s("viewModel.persistSizeRangeEnabled")],z.prototype,"persistSizeRangeEnabled",void 0),e([s("viewModel.stops")],z.prototype,"stops",void 0),e([t()],z.prototype,"style",void 0),e([o("style")],z.prototype,"castStyle",null),e([t()],z.prototype,"viewModel",void 0),e([s("viewModel.zoomOptions")],z.prototype,"zoomOptions",void 0),z=v=e([a("esri.widgets.smartMapping.BinaryColorSizeSlider")],z);const w=z;export{w as default};
