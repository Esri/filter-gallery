/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import s from"../core/Handles.js";import{on as t,watch as i,init as r}from"../core/watchUtils.js";import{aliasOf as o}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/arrayUtils.js";import"../core/has.js";import{cast as n}from"../core/accessorSupport/decorators/cast.js";import{property as a}from"../core/accessorSupport/decorators/property.js";import{subclass as d}from"../core/accessorSupport/decorators/subclass.js";import l from"./Widget.js";import c from"./Legend/LegendViewModel.js";import p from"./Legend/styles/Card.js";import h from"./Legend/styles/Classic.js";import"./support/widgetUtils.js";import{messageBundle as y}from"./support/decorators/messageBundle.js";import"../core/Logger.js";import{tsx as v}from"./support/jsxFactory.js";const g={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let f=class extends l{constructor(e,t){super(e,t),this._handles=new s,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=g.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new h,this.view=null,this.viewModel=new c}initialize(){this.own(t(this,"view","resize",(()=>this.scheduleRender())),t(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),i(this,"headingLevel",(e=>{const{style:s}=this;s&&(s.headingLevel=e)})),r(this,"style",((e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)})))}destroy(){this._handles.destroy(),this._handles=null}castStyle(e){if(e instanceof p||e instanceof h)return e;if("string"==typeof e)return"card"===e?new p:new h;if(e&&"string"==typeof e.type){const s={...e};delete s.type;return new("card"===e.type?p:h)(s)}return new h}render(){return v("div",{class:this.classes(g.base,g.widget,this.style instanceof h?g.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const s=r(e,"version",(()=>this.scheduleRender()));this._handles.add(s,`version_${e.layer.uid}`);const i=t(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(i,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};e([o("viewModel.activeLayerInfos")],f.prototype,"activeLayerInfos",void 0),e([o("viewModel.basemapLegendVisible")],f.prototype,"basemapLegendVisible",void 0),e([o("viewModel.groundLegendVisible")],f.prototype,"groundLegendVisible",void 0),e([a()],f.prototype,"headingLevel",void 0),e([o("viewModel.hideLayersNotInCurrentView")],f.prototype,"hideLayersNotInCurrentView",void 0),e([o("viewModel.keepCacheOnDestroy")],f.prototype,"keepCacheOnDestroy",void 0),e([o("viewModel.respectLayerVisibility")],f.prototype,"respectLayerVisibility",void 0),e([a()],f.prototype,"iconClass",void 0),e([a({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0),e([o("viewModel.layerInfos")],f.prototype,"layerInfos",void 0),e([a(),y("esri/widgets/Legend/t9n/Legend")],f.prototype,"messages",void 0),e([a()],f.prototype,"style",void 0),e([n("style")],f.prototype,"castStyle",null),e([o("viewModel.view")],f.prototype,"view",void 0),e([a()],f.prototype,"viewModel",void 0),f=e([d("esri.widgets.Legend")],f);const L=f;export{L as default};
