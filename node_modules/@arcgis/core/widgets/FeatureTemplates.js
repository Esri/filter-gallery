/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{HandleOwnerMixin as t}from"../core/HandleOwner.js";import{isNone as r}from"../core/maybe.js";import{init as s}from"../core/watchUtils.js";import{aliasOf as i}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/arrayUtils.js";import"../core/has.js";import{cast as o}from"../core/accessorSupport/decorators/cast.js";import{property as l}from"../core/accessorSupport/decorators/property.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import a from"./Widget.js";import c from"./FeatureTemplates/FeatureTemplatesViewModel.js";import{ItemList as d}from"./FeatureTemplates/ItemList.js";import m from"./FeatureTemplates/TemplateItem.js";import"./support/widgetUtils.js";import{messageBundle as p}from"./support/decorators/messageBundle.js";import"../core/Logger.js";import{vmEvent as u}from"./support/decorators/vmEvent.js";import{tsx as h}from"./support/jsxFactory.js";const f={base:"esri-feature-templates",loader:"esri-feature-templates__loader",widget:"esri-widget"};function v(e){return"items"in e}function b(e){return e.length>0&&v(e[0])}function I(e){const{label:t}=e;return v(e)?t:`${t}â€“${e.layer.id}`}const y={filter:!0};let g=class extends(t(a)){constructor(e,t){super(e,t),this._iconIntersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const s=e.target;if(s["data-has-icon"])return void t.unobserve(s);const i=s["data-item"],{layer:o,template:l}=i;s["data-has-icon"]=!0;const n=await m.fetchThumbnail(o,l).catch((()=>(s["data-has-icon"]=!1,null)));if(r(n))return;s.appendChild(n)}}))})),this.enableListScroll=!0,this.filterFunction=null,this.filterText="",this.groupBy=null,this.headingLevel=4,this.label=void 0,this.layers=null,this.messages=null,this.selectedItem=null,this.viewModel=new c,this.visibleElements={...y},this.renderItemIcon=this.renderItemIcon.bind(this),this._afterItemCreateOrUpdate=this._afterItemCreateOrUpdate.bind(this),this._afterItemRemoved=this._afterItemRemoved.bind(this)}initialize(){const e=({label:e})=>!this.filterText||e.toLowerCase().indexOf(this.filterText.toLowerCase())>-1;this.own(s(this,"viewModel",((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)})))}destroy(){this._iconIntersectionObserver&&(this._iconIntersectionObserver.disconnect(),this._iconIntersectionObserver=null)}loadDependencies(){return Promise.all([import("@esri/calcite-components/dist/components/calcite-icon.js"),import("@esri/calcite-components/dist/components/calcite-input.js"),import("@esri/calcite-components/dist/components/calcite-list-item.js"),import("@esri/calcite-components/dist/components/calcite-progress.js")])}castVisibleElements(e){return{...y,...e}}select(e){return null}render(){const{enableListScroll:e,filterText:t,headingLevel:r,messages:s,viewModel:{items:i,selectedItem:o,state:l}}=this,n=this.visibleElements.filter;if(b(i)){const e=i.find((e=>e.label===c.nullGroupBy.label));e&&(e.label=s.other)}return h("div",{class:this.classes(f.base,f.widget),"aria-label":s.widgetLabel},"loading"===l?this.renderLoader():"ready"===l?h(d,{id:this.id,identify:I,filterText:t,items:i,headingLevel:r,messages:{filterPlaceholder:s.filterPlaceholder,noItems:s.noItems,noMatches:s.noMatches},filterEnabled:n,onItemSelect:e=>{this.viewModel.select(e)},onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()},renderIcon:this.renderItemIcon,selectedItem:o,enableListScroll:e}):null)}renderItemIcon({item:e}){return h("span",{key:"icon",afterCreate:this._afterItemCreateOrUpdate,afterUpdate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,"data-item":e,"data-has-icon":!1})}renderLoader(){return h("div",{class:f.loader,key:"loader"})}_afterItemCreateOrUpdate(e){var t;null==(t=this._iconIntersectionObserver)||t.observe(e)}_afterItemRemoved(e){var t;null==(t=this._iconIntersectionObserver)||t.unobserve(e)}};e([l()],g.prototype,"enableListScroll",void 0),e([i("viewModel.filterFunction")],g.prototype,"filterFunction",void 0),e([l()],g.prototype,"filterText",void 0),e([i("viewModel.groupBy")],g.prototype,"groupBy",void 0),e([l()],g.prototype,"headingLevel",void 0),e([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0),e([i("viewModel.layers")],g.prototype,"layers",void 0),e([l(),p("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],g.prototype,"messages",void 0),e([i("viewModel.selectedItem")],g.prototype,"selectedItem",void 0),e([l(),u("select")],g.prototype,"viewModel",void 0),e([l()],g.prototype,"visibleElements",void 0),e([o("visibleElements")],g.prototype,"castVisibleElements",null),e([i("viewModel.select")],g.prototype,"select",null),g=e([n("esri.widgets.FeatureTemplates")],g);const w=g;export{w as default};
