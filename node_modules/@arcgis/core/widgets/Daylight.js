/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../core/Logger.js";import{applySome as i,isSome as s}from"../core/maybe.js";import{watch as o,initial as a,when as r}from"../core/reactiveUtils.js";import{aliasOf as l}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/arrayUtils.js";import"../core/has.js";import{cast as n}from"../core/accessorSupport/decorators/cast.js";import{property as d}from"../core/accessorSupport/decorators/property.js";import{subclass as c}from"../core/accessorSupport/decorators/subclass.js";import h from"./Widget.js";import p from"./Daylight/DaylightViewModel.js";import{ORDERED_SEASONS as m}from"./Daylight/support/daylightUtils.js";import g from"./Daylight/support/SliderWithDropdown.js";import u from"./support/DatePicker.js";import{Heading as v}from"./support/Heading.js";import{formatSliderLabel as w,getTimezoneInfos as y}from"./support/timeWidgetUtils.js";import"./support/widgetUtils.js";import{messageBundle as b}from"./support/decorators/messageBundle.js";import{tsx as _}from"./support/jsxFactory.js";const f={base:"esri-daylight",widgetIcon:"esri-icon-environment-settings",button:"esri-button",checkbox:"esri-daylight__checkbox",checked:"esri-icon-checkbox-checked",dayContainer:"esri-daylight__container esri-daylight__day-container",dateContainer:"esri-daylight__container esri-daylight__date-container",interactive:"esri-interactive",label:" esri-widget__anchor",labelledTick:"esri-daylight__container__labelled-tick",pause:"esri-icon-pause",play:"esri-icon-play",playPauseButton:"esri-daylight__play-pause-button",select:"esri-select",seasonPicker:"esri-daylight__season-picker",shadow:"esri-daylight__shadow-container",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",tick:"esri-daylight__container__tick",unchecked:"esri-icon-checkbox-unchecked",widget:"esri-widget",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",panelError:"esri-daylight__panel--error"},S={playButtons:!0,shadowsToggle:!0,datePicker:!0,timezone:!0},k=/(.*)\s(.*)/,M=t.getLogger("esri.widgets.Daylight"),O="date";let P=class extends h{constructor(e,t){var i;super(e,t),this.headingLevel=3,this.iconClass=f.widgetIcon,this.label=void 0,this.playSpeedMultiplier=1,this.timeSliderSteps=5,this.view=null,this.viewModel=new p,this.visibleElements={...S},this.dateOrSeason=O,this._timeSlider=new g({viewModel:this.viewModel.timeSliderViewModel,labelFormatFunction:w,inputFormatFunction:w,min:0,max:1439,steps:null!=(i=this.timeSliderSteps)?i:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:this._onPrimaryTickCreated.bind(this)},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:this._onSecondaryTickCreated.bind(this)}],items:[]}),this._datePicker=new u({viewModel:this.viewModel.datePickerViewModel,commitOnMonthChange:!0})}get gmtOffsets(){return i(this.timezoneMessages,y)}castVisibleElements(e){return{...S,...e}}postInitialize(){this.viewModel.isSupported&&this.own(o((()=>this.viewModel.datePickerViewModel),(e=>this._datePicker.viewModel=e),a),o((()=>this.viewModel.timeSliderViewModel),(e=>this._timeSlider.viewModel=e),a),o((()=>{var e;return null==(e=this.timezoneMessages)?void 0:e.chooseTimezone}),(e=>this._timeSlider.buttonTooltip=e),a),o((()=>{var e;return null==(e=this.visibleElements)?void 0:e.timezone}),(e=>this._timeSlider.showDropDown=e),a),r((()=>this.gmtOffsets),(e=>{this._timeSlider.items=e.map((e=>({utcOffset:e.utcOffset,name:e.short,label:[e.shortWithUTC,e.long]})))}),a),o((()=>[this.viewModel.utcOffset,this.gmtOffsets]),(()=>this._onUTCOffsetChange()),a))}destroy(){this._datePicker.destroy(),this._timeSlider.destroy()}render(){return this.viewModel.isSupported?_("div",{class:this.classes(f.base,f.widget)},_(v,{level:this.headingLevel},this.messages.title),this.renderTimeOptions(),this.visibleElements.datePicker?"date"===this.dateOrSeason?this.renderDateOptions():this.renderSeasonOptions():null,this.visibleElements.shadowsToggle?this.renderShadowOptions():null):_("div",{class:this.classes(f.base,f.widget)},_("div",{key:"daylight__unsupported",class:f.panelError},_("p",null,this.messages.unsupported)))}renderTimeOptions(){const e={[f.play]:!this.viewModel.dayPlaying,[f.pause]:this.viewModel.dayPlaying},t={[f.shadowOn]:this.viewModel.directShadowsEnabled,[f.shadowOff]:!this.viewModel.directShadowsEnabled},i={[f.sliderDateOn]:this.visibleElements.datePicker,[f.sliderDateOff]:!this.visibleElements.datePicker};return _("div",{class:this.classes(f.dayContainer,t,i),key:"daylight-time-options"},this._timeSlider.render(),this.visibleElements.playButtons?_("button",{bind:this.viewModel,onclick:this.viewModel.toggleDayPlaying,"aria-label":this.messages.playDay,title:this.messages.playDay,type:"button",class:this.classes(f.button,f.playPauseButton,e)},_("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},_("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)}renderDateOptions(){const e={[f.play]:!this.viewModel.yearPlaying,[f.pause]:this.viewModel.yearPlaying};return _("div",{class:f.dateContainer,key:"daylight-date-options"},this._datePicker.render(),this.visibleElements.playButtons?_("button",{bind:this.viewModel,onclick:this.viewModel.toggleYearPlaying,"aria-label":this.messages.playYear,title:this.messages.playYear,type:"button",class:this.classes(f.button,f.playPauseButton,e)},_("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},_("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)}renderShadowOptions(){const e=`${this.id}__shadowButton`,t={[f.checked]:this.viewModel.directShadowsEnabled,[f.unchecked]:!this.viewModel.directShadowsEnabled};return _("div",{class:f.shadow,key:"daylight-shadow-options"},_("button",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,name:e,class:this.classes(f.button,f.checkbox,t),"aria-label":this.messages.directShadow,title:this.messages.directShadow,type:"button"}),_("label",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,for:e,class:this.classes(f.label,f.interactive),"aria-label":this.messages.directShadow,title:this.messages.directShadow},this.messages.directShadow))}renderSeasonOptions(){return _("select",{bind:this,onchange:this._onSeasonChange,class:this.classes(f.select,f.seasonPicker),value:this.viewModel.currentSeason,"aria-label":this.messages.season},m.map((e=>_("option",{value:e},this.messages[e]))))}_onSeasonChange(e){const t=e.target;this.viewModel.currentSeason=t.value}_onUTCOffsetChange(){var e;const t=this.viewModel.utcOffset,i=null==(e=this._timeSlider.currentItem)?void 0:e.utcOffset,o=this.gmtOffsets;if(!s(o)||i===t)return;const a=o.findIndex((({utcOffset:e})=>e===t));a>-1&&(this._timeSlider.currentIndex=a)}_onPrimaryTickCreated(e,t,i){t.className+=" esri-interactive esri-widget__anchor "+f.tick+" "+f.labelledTick,i.className+=" esri-interactive esri-widget__anchor";const s=()=>{this.viewModel.timeSliderPosition=e};t.onclick=s,i.onclick=s;const o=i.innerText.match(k);o&&(i.innerHTML=`${o[1]}<br><div class="esri-label__ampm">${o[2]}</div>`)}_onSecondaryTickCreated(e,t){t.className+=" esri-interactive esri-widget__anchor "+f.tick,t.onclick=()=>{this.viewModel.timeSliderPosition=e}}};e([d({readOnly:!0})],P.prototype,"gmtOffsets",null),e([d(),b("esri/widgets/Daylight/t9n/Daylight")],P.prototype,"messages",void 0),e([d(),b("esri/widgets/support/t9n/timezone")],P.prototype,"timezoneMessages",void 0),e([d()],P.prototype,"headingLevel",void 0),e([d()],P.prototype,"iconClass",void 0),e([d({aliasOf:{source:"messages.title",overridable:!0}})],P.prototype,"label",void 0),e([l("viewModel.playSpeedMultiplier")],P.prototype,"playSpeedMultiplier",void 0),e([l("_timeSlider.steps")],P.prototype,"timeSliderSteps",void 0),e([l("viewModel.view")],P.prototype,"view",void 0),e([d({type:p})],P.prototype,"viewModel",void 0),e([d()],P.prototype,"visibleElements",void 0),e([n("visibleElements")],P.prototype,"castVisibleElements",null),e([d({cast:e=>"season"===e||"date"===e?e:(M.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${O}".`),O)})],P.prototype,"dateOrSeason",void 0),e([d()],P.prototype,"_timeSlider",void 0),e([d()],P.prototype,"_datePicker",void 0),P=e([c("esri.widgets.Daylight")],P);const D=P;export{D as default};
