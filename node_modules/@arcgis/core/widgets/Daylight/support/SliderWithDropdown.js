/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as o}from"../../../chunks/tslib.es6.js";import{eventKey as e}from"../../../core/events.js";import{isSome as t}from"../../../core/maybe.js";import{property as r}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import{subclass as i}from"../../../core/accessorSupport/decorators/subclass.js";import s from"../../Slider.js";import{SliderWithDropdownViewModel as n}from"./SliderWithDropdownViewModel.js";import"../../support/widgetUtils.js";import"../../../core/Logger.js";import{tsx as l}from"../../support/jsxFactory.js";const d={interactive:"esri-interactive",label:"esri-slider__label",box:"esri-slider-with-dropdown__box",dropdownRoot:"esri-slider-with-dropdown__dropdown-root",anchor:" esri-widget__anchor esri-slider-with-dropdown__anchor",anchorOpen:"esri-slider-with-dropdown__anchor--open",anchorClosed:"esri-slider-with-dropdown__anchor--closed",dropdownList:"esri-slider-with-dropdown__list",dropdownListItem:"esri-slider-with-dropdown__list-item",dropdownListItemSelected:"esri-slider-with-dropdown__list-item--selected",boxDropDownOn:"esri-slider-with-dropdown__box--drop-down-on",boxDropDownOff:"esri-slider-with-dropdown__box--drop-down-off"},p={selectItem:"Enter",closeDropdown:"Escape",moveSelectionUp:"ArrowUp",moveSelectionDown:"ArrowDown"};let a=class extends s{constructor(o,e){super(o,e),this.viewModel=new n,this.buttonTooltip="",this.showDropDown=!0,this.currentIndex=0,this._rootNode=null}renderThumbLabel(o){const e={[d.boxDropDownOn]:this.showDropDown,[d.boxDropDownOff]:!this.showDropDown};return l("div",{class:this.classes(d.box,d.label,e)},super.renderThumbLabel(o),this.showDropDown?l("div",{bind:this,afterCreate:this._onRootNodeCreate,class:d.dropdownRoot},l("button",{class:this.classes(d.interactive,d.anchor,this.isDropdownOpen?d.anchorOpen:d.anchorClosed),bind:this,onclick:this._onAnchorClick,onpointerdown:this._killEvent,"aria-label":this.buttonTooltip,title:this.buttonTooltip,"aria-expanded":this.isDropdownOpen.toString(),"aria-haspopup":"listbox",type:"button"},this.currentItem?this.currentItem.name+" ":""),this.isDropdownOpen?l("ol",{class:this.classes(d.dropdownList),onpointerdown:this._killEvent,onblur:this._onDropdownBlur,bind:this,tabindex:"-1","aria-label":this.buttonTooltip,role:"listbox",onkeydown:this._onOlKeyDown,afterCreate:this._focusOnSelectedItem},this.items.map(((o,e)=>l("li",{class:e===this.currentIndex?this.classes(d.interactive,d.dropdownListItem,d.dropdownListItemSelected):this.classes(d.interactive,d.dropdownListItem),bind:this,onclick:this._onDropdownItemClick,"data-result":e,"aria-label":o.label.join(" "),role:"option","aria-selected":(e===this.currentIndex).toString(),onkeydown:this._onLiKeyDown,onblur:this._onDropdownBlur,tabindex:"0"},o.label.map((o=>l("span",{bind:this},o))))))):null):null)}_onRootNodeCreate(o){this._rootNode=o}_focusOnSelectedItem(o){var e;const r=null!=(e=o.querySelector(`.${d.dropdownListItemSelected}`))?e:o.firstChild;t(r)&&r instanceof HTMLElement&&(r.scrollIntoView(),r.focus())}_onAnchorClick(){return this.viewModel.toggle(),!0}_onDropdownItemClick(o){const e=o.currentTarget;this.viewModel.selectItem(e["data-result"])}_onDropdownBlur(o){let e=o.relatedTarget;null===e&&(e=document.activeElement),t(this._rootNode)&&!this._rootNode.contains(e)&&e!==this._rootNode.parentElement&&e!==this._rootNode.parentElement.parentElement&&(this.viewModel.isDropdownOpen=!1)}_killEvent(o){return o.stopPropagation(),!0}_onOlKeyDown(o){o.stopPropagation(),e(o)===p.closeDropdown&&(this.viewModel.isDropdownOpen=!1)}_onLiKeyDown(o){const t=o.target;switch(e(o)){case p.moveSelectionUp:if(t.previousElementSibling){t.previousElementSibling.focus()}break;case p.moveSelectionDown:if(t.nextElementSibling){t.nextElementSibling.focus()}break;case p.selectItem:t.click()}}};o([r()],a.prototype,"viewModel",void 0),o([r()],a.prototype,"buttonTooltip",void 0),o([r()],a.prototype,"showDropDown",void 0),o([r({aliasOf:"viewModel.items"})],a.prototype,"items",void 0),o([r({aliasOf:"viewModel.currentIndex"})],a.prototype,"currentIndex",void 0),o([r({aliasOf:"viewModel.currentItem"})],a.prototype,"currentItem",void 0),o([r({aliasOf:"viewModel.isDropdownOpen"})],a.prototype,"isDropdownOpen",void 0),a=o([i("esri.widgets.Daylight.SliderWithDropdown")],a);const c=a;export{c as default};
