/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{createScreenPoint as r}from"../core/screenUtils.js";import{whenTrue as t,watch as s}from"../core/watchUtils.js";import{aliasOf as i}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/arrayUtils.js";import"../core/has.js";import{cast as a}from"../core/accessorSupport/decorators/cast.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import{subclass as l}from"../core/accessorSupport/decorators/subclass.js";import n from"./Widget.js";import c from"./ScaleBar/ScaleBarViewModel.js";import"./support/widgetUtils.js";import{messageBundle as d}from"./support/decorators/messageBundle.js";import"../core/Logger.js";import{tsx as p}from"./support/jsxFactory.js";const u={base:"esri-scale-bar esri-widget",labelContainer:"esri-scale-bar__label-container",rulerLabelContainer:"esri-scale-bar__label-container--ruler",lineLabelContainer:"esri-scale-bar__label-container--line",topLabelContainer:"esri-scale-bar__label-container--top",bottomLabelContainer:"esri-scale-bar__label-container--bottom",label:"esri-scale-bar__label",line:"esri-scale-bar__line",topLine:"esri-scale-bar__line--top",bottomLine:"esri-scale-bar__line--bottom",ruler:"esri-scale-bar__ruler",rulerBlock:"esri-scale-bar__ruler-block",barContainer:"esri-scale-bar__bar-container",rulerBarContainer:"esri-scale-bar__bar-container--ruler",lineBarContainer:"esri-scale-bar__bar-container--line",disabled:"esri-disabled"};function b(e){return 2*e}let m=class extends n{constructor(e,r){super(e,r),this.label=void 0,this.messages=null,this.unit="non-metric",this.view=null,this.viewModel=new c}initialize(){this.own([t(this,"view.stationary",(()=>this.scheduleRender())),s(this,["view.center","view.scale","view.zoom"],(()=>{this.view.stationary&&this.scheduleRender()}))])}set style(e){const r="dual"===this.unit?"line":e;this._set("style",r)}castStyle(e){return"line"===e?e:"ruler"}castUnit(e){return"metric"===e||"dual"===e?e:"non-metric"}render(){const e="disabled"===this.get("viewModel.state"),r={[u.disabled]:e};let t,s;if(!e){const{unit:e,style:r}=this,i="metric"===e||"dual"===e,a=50;if("non-metric"===e||"dual"===e){const e=this.viewModel.getScaleBarProperties(a,"non-metric");e&&(s="ruler"===r?this._renderRuler(e):this._renderLine(e,"bottom"))}if(i){const e=this.viewModel.getScaleBarProperties(a,"metric");e&&(t="ruler"===r?this._renderRuler(e):this._renderLine(e,"top"))}}return p("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(u.base,r)},t,s)}_renderRuler(e){const r=b(Math.round(e.length)),{messages:t}=this,s=t[e.unit]||t.unknownUnit,i=`${b(e.value)} ${s}`;return p("div",{class:this.classes(u.barContainer,u.rulerBarContainer),key:"esri-scale-bar__ruler"},p("div",{class:u.ruler,styles:{width:`${r}px`}},p("div",{class:u.rulerBlock}),p("div",{class:u.rulerBlock}),p("div",{class:u.rulerBlock}),p("div",{class:u.rulerBlock})),p("div",{class:this.classes(u.labelContainer,u.rulerLabelContainer)},p("div",{class:u.label},"0"),p("div",{class:u.label},i)))}_renderLine(e,r){const{messages:t}=this,s=t[e.unit]||t.unknownUnit,i=`${b(e.value)} ${s}`,a={[u.topLabelContainer]:"top"===r,[u.bottomLabelContainer]:"bottom"===r},o=p("div",{class:this.classes(u.labelContainer,u.lineLabelContainer,a),key:"esri-scale-bar__label"},p("div",{class:u.label},i)),l={[u.topLine]:"top"===r,[u.bottomLine]:"bottom"===r},n=b(Math.round(e.length)),c=p("div",{class:this.classes(u.line,l),key:"esri-scale-bar__line",styles:{width:`${n}px`}});return p("div",{class:this.classes(u.barContainer,u.lineBarContainer),key:"esri-scale-bar__line-container"},[c,o])}_handleRootCreateOrUpdate(e){const t=this.viewModel;if(!t)return;const s=e.getBoundingClientRect(),i=s.left+window.pageXOffset,a=s.top+window.pageYOffset,o=r(i,a);(o.x!==t.scaleComputedFrom.x||o.y!==t.scaleComputedFrom.y)&&(t.scaleComputedFrom=o)}};e([o({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],m.prototype,"label",void 0),e([o(),d("esri/widgets/ScaleBar/t9n/ScaleBar")],m.prototype,"messages",void 0),e([o()],m.prototype,"style",null),e([a("style")],m.prototype,"castStyle",null),e([o()],m.prototype,"unit",void 0),e([a("unit")],m.prototype,"castUnit",null),e([i("viewModel.view")],m.prototype,"view",void 0),e([o()],m.prototype,"viewModel",void 0),m=e([l("esri.widgets.ScaleBar")],m);const h=m;export{h as default};
