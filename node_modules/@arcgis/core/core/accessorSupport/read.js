/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{valueOf as e,exists as t}from"./get.js";import{getProperties as r}from"./utils.js";import{originSpecificReadPropertyDefinition as n,originSpecificPropertyDefinition as o}from"./extensions/serializableProperty.js";function s(e,r,n){if(!e||!e.read||!1===e.read.enabled||!e.read.source)return!1;const o=e.read.source;if("string"==typeof o){if(o===r)return!0;if(o.indexOf(".")>-1&&0===o.indexOf(r)&&t(o,n))return!0}else for(const s of o){if(s===r)return!0;if(s.indexOf(".")>-1&&0===s.indexOf(r)&&t(s,n))return!0}return!1}function i(e){return e&&(!e.read||!1!==e.read.enabled&&!e.read.source)}function f(e,t,r,o,f){let a=n(t[r],f);i(a)&&(e[r]=!0);for(const i of Object.getOwnPropertyNames(t))a=n(t[i],f),s(a,r,o)&&(e[i]=!0)}function a(e,t,r,n){const s=r.metadatas,i=o(s[t],"any",n),f=i&&i.default;if(void 0===f)return;const a="function"==typeof f?f.call(e,t,n):f;void 0!==a&&r.set(t,a)}const c={origin:"service"};function u(t,o,s=c){if(!o||"object"!=typeof o)return;const i=r(t),u=i.metadatas,d={};for(const e of Object.getOwnPropertyNames(o))f(d,u,e,o,s);i.setDefaultOrigin(s.origin);for(const r of Object.getOwnPropertyNames(d)){const f=n(u[r],s).read,a=f&&f.source;let c;c=a&&"string"==typeof a?e(o,a):o[r],f&&f.reader&&(c=f.reader.call(t,c,o,s)),void 0!==c&&i.set(r,c)}if(!s||!s.ignoreDefaults){i.setDefaultOrigin("defaults");for(const e of Object.getOwnPropertyNames(u))d[e]||a(t,e,i,s)}i.setDefaultOrigin("user")}function d(e,t,r,n=c){var o;const s={...n,messages:[]};r(s),null==(o=s.messages)||o.forEach((t=>{"warning"!==t.type||e.loaded?n&&n.messages&&n.messages.push(t):e.loadWarnings.push(t)}))}export{u as read,d as readLoadable};
