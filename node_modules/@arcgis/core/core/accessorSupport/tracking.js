/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import"../has.js";import t from"../Logger.js";import{pathToArray as n,getProperties as r}from"./utils.js";import{Flags as o}from"./tracking/Flags.js";let e,i=[];const c=t.getLogger("esri.core.Accessor");function s(){i=[]}function l(t){void 0!==e&&e.onObservableAccessed(t)}let a=!1,f=!1;function g(t,n,r){if(a)return p(t,n,r);d(t);const o=n.call(r);return m(),o}function u(t,n){return g(void 0,t,n)}function p(t,n,r){const o=a;a=!0,d(t);let e=null;try{e=n.call(r)}catch(i){f&&c.error(i)}return m(),a=o,e}function d(t){e=t,i.push(t)}function m(){const t=i.pop();e=i.length>0?i[i.length-1]:void 0,void 0!==t&&t.onTrackingEnd()}function y(t,n){if(n.flags&o.DepTrackingInitialized)return;const r=f;f=!1,n.flags&o.AutoTracked?p(n,n.metadata.get,t):h(t,n),f=r}const A=[];function h(t,r){r.flags&o.ExplicitlyTracking||(r.flags|=o.ExplicitlyTracking,p(r,(()=>{const o=r.metadata.dependsOn||A;for(const r of o)if("string"==typeof r&&-1===r.indexOf("."))k(t,r,!1);else{const o=n(r);for(let n=0,r=t;n<o.length&&null!=r&&"object"==typeof r;++n)r=k(r,o[n],n!==o.length-1)}})),r.flags&=~o.ExplicitlyTracking)}function k(t,n,o){const e="?"===n[n.length-1]?n.slice(0,-1):n;if(null!=t.getItemAt||Array.isArray(t)){const n=parseInt(e,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.getItemAt(n)}const i=r(t),c=null==i?void 0:i.properties.get(e);return c&&(l(c),y(t,c)),o?t[e]:void 0}export{y as initializeDependencyTracking,s as resetGlobalTarget,g as runTracked,p as runTrackedNoThrow,u as runUntracked,l as trackAccess,h as trackExplicitDependencies};
