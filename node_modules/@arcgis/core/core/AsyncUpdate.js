/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import e from"./Accessor.js";import s from"./Logger.js";import{runTracked as a}from"./accessorSupport/tracking.js";import{property as n}from"./accessorSupport/decorators/property.js";import{subclass as r}from"./accessorSupport/decorators/subclass.js";import{SimpleTrackingTarget as o}from"./accessorSupport/tracking/SimpleTrackingTarget.js";const c=e=>{let a=class extends e{constructor(){super(...arguments),this._numUpdating=0,this.asyncUpdateState=new Map}get updating(){return this._numUpdating>0}autoUpdateAsync(t,e){return p((e=>this._updateAsync(t,e)),e)}async _updateAsync(t,e){if(!this._startAsyncUpdate(t)){try{const s=await e();this._set(t,s)}catch(a){s.getLogger(this.declaredClass).warn(`Async update of "${t}" failed. Async update functions should not throw exceptions.`)}this._endAsyncUpdate(t)&&this._updateAsync(t,e)}}_startAsyncUpdate(t){var e;const s=null!=(e=this.asyncUpdateState.get(t))?e:i.None;return s&i.Updating?(this.asyncUpdateState.set(t,s|i.Invalidated),!0):(++this._numUpdating,this.asyncUpdateState.set(t,s|i.Updating),!1)}_endAsyncUpdate(t){var e;--this._numUpdating;const s=(null!=(e=this.asyncUpdateState.get(t))?e:i.None)&~i.Updating;return s&i.Invalidated?(this.asyncUpdateState.set(t,s&~i.Invalidated),!0):(this.asyncUpdateState.set(t,s),!1)}};return t([n({readOnly:!0})],a.prototype,"updating",null),t([n()],a.prototype,"_numUpdating",void 0),a=t([r("esri.core.AsyncUpdate")],a),a};var i;function p(t,e){const s=()=>{c&&!i&&t(n)},n=()=>{if(!c||i)return e();c.clear(),i=!0;const t=a(c,e);return i=!1,t},r=()=>{c&&(c.destroy(),c=null)};let c=new o(s),i=!1;return t(n),{remove:r}}!function(t){t[t.None=0]="None",t[t.Updating=1]="Updating",t[t.Invalidated=2]="Invalidated"}(i||(i={}));let d=class extends(c(e)){};d=t([r("esri.core.AsyncUpdate")],d);export{d as AsyncUpdate,c as AsyncUpdateMixin};
