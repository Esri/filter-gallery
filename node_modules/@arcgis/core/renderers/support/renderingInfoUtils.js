/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
import t from"../../Color.js";import{isSome as e,isNone as o}from"../../core/maybe.js";import{getVisualVariableValues as r}from"../visualVariables/support/visualVariableUtils.js";function i(t,o){if(!t||t.symbol)return null;const r=o&&o.renderer;return t&&e(r)&&r.getObservationRenderer?r.getObservationRenderer(t):r}function n(t,o){if(e(t.symbol))return t.symbol;const r=i(t,o);return e(r)&&"dot-density"!==r.type?r.getSymbol(t,o):null}function a(t,e){const a=i(t,e),l=n(t,e);if(o(l))return null;const s={renderer:a,symbol:l};if(o(a)||!("visualVariables"in a)||!a.visualVariables)return s;const u=r(a,t,e),c=["proportional","proportional","proportional"];for(const{variable:o,value:r}of u)switch(o.type){case"color":s.color=r.toRgba();break;case"size":if("outline"===o.target)s.outlineSize=r;else{const t=o.axis,e=o.useSymbolValue?"symbol-value":r;switch(t){case"width":c[0]=e;break;case"depth":c[1]=e;break;case"height":c[2]=e;break;case"width-and-depth":c[0]=c[1]=e;break;default:c[0]=c[1]=c[2]=e}}break;case"opacity":s.opacity=r;break;case"rotation":switch(o.axis){case"tilt":s.tilt=r;break;case"roll":s.roll=r;break;default:s.heading=r}}return"proportional"===c[0]&&"proportional"===c[1]&&"proportional"===c[2]||(s.size=c),s}async function l(t,o){if(e(t.symbol))return t.symbol;const r=i(t,o);return e(r)&&r.getSymbolAsync(t,{...o,abortOptions:{signal:o.signal}})}async function s(e,o){const n=i(e,o),a=await l(e,o);if(!a)return null;const s={renderer:n,symbol:a};if(!n||!("visualVariables"in n)||!n.visualVariables)return s;const u=r(n,e,o),c=["proportional","proportional","proportional"];for(const{variable:r,value:i}of u)if("color"===r.type)s.color=t.toUnitRGBA(i);else if("size"===r.type)if("outline"===r.target)s.outlineSize=i;else{const t=r.axis,e=r.useSymbolValue?"symbol-value":i;"width"===t?c[0]=e:"depth"===t?c[1]=e:"height"===t?c[2]=e:c[0]=c[1]="width-and-depth"===t?e:c[2]=e}else"opacity"===r.type?s.opacity=i:"rotation"===r.type&&"tilt"===r.axis?s.tilt=i:"rotation"===r.type&&"roll"===r.axis?s.roll=i:"rotation"===r.type&&(s.heading=i);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function u(t,e=0){const o=t[e];return"number"==typeof o&&isFinite(o)?o:null}function c(t){for(let e=0;e<3;e++){const o=t[e];if("number"==typeof o)return isFinite(o)?o:0}return 0}export{u as getDriverAxisSizeValue,c as getDriverAxisSizeValueAny,i as getRenderer,a as getRenderingInfo,s as getRenderingInfoAsync,l as getSymbolAsync};
